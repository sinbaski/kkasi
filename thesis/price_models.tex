\chapter{Return Models}\label{chp:PriceModels}
In this chapter we review some of the discrete-time return models and
fit them to intraday returns. The intention is to compare these models
in terms of forecast accuracy and to understand their statistical
properties. In the following we first describe these models briefly,
then in section \ref{chp:nordea_15min}, section \ref{sec:volvo_30} and appendix
\ref{chp:appendix2} we describe how the \gls{garch} and the \gls{sv} models
are fitted to intraday returns and compare their forecasts. In section
\ref{sec:XieCalc} we calculate the unconditional distribution
functions of the \gls{sv} model.

% \gls{frt} is good.
% section \ref{sec:Garch_model} reviews the \gls{garch} model using the Nordea
% 15-minute returns as an example. Section \ref{sec:SLV_model} examines the
% stochastic log-volatility model and discusses the possibility of
% describing the residuals of the log-volotility series using the
% Johnson Su distribution. The same Nordea return series is fitted as an
% example. Section \ref{sec:XieCalc} derives the unconditional distribution
% function of the stochastic log-volotility model and compares the
% analytic results to the 30-minute returns of a number of Swedish
% stocks.

\begin{enumerate}
\item{\bf Gaussian Distribution}

The justification of modeling return series as independent,
identically distributed normal variates comes from imagining the
price process $S_t$ as a stochastic process with
  independent and normally distributed relative increments $dS_t / S_t
  = \sigma dw_t$, where $w_t$ represents the path of a geometric
  Brownian motion and $dw_t$ is normally distributed with mean 0 and
  variance $dt$.

By adding a drift term $\mu dt$ to allow a deterministic trend in the
relative price change, one can express the price $S_t$ as a stochastic
differential equation:
\begin{eqnarray*}
  {dS_t \over S_t} &=& \mu dt + \sigma dw_t \\
\end{eqnarray*}
By It\^o's lemma, a stochastic differential
equation for the logarithmic price $\ln S_t$ can be obtained
\begin{eqnarray*}
  d(\ln S_t) &=& (\mu - \frac{1}{2} \sigma^2)dt + \sigma dw_t \\
\end{eqnarray*}
Solving this equation gives
\begin{eqnarray*}
  \ln S_t - \ln S_0 &=& (\mu - \frac{1}{2} \sigma^2)dt + \sigma w_t \\
\end{eqnarray*}
It follows from this equation that $\ln S(t) - \ln S_0$, where $S_0$
is the price at time 0, has Gaussian distribution with mean $(\mu -
\sigma^2/2)t$ and variance $\sigma^2 t$ \cite{Bernt2000}. Therefore,
in a discrete-time model, where the length of each time step $\Delta
t$ is fixed, the return $r_t = \ln S(t) - \ln S(t - \Delta t)$ is
assumed to be Gaussian distributed and have mean and variance that are
functions of $\Delta t$.

The picture depicted above is of course overly simplified, and the
distribution of returns is not really Gaussian. Nevertheless, the
assumption of Gaussian distributed returns underlies such important
theories as Black and Scholes theory of option pricing. Thus, albeit
inaccurate in describing very large returns, the Gaussian distribution
as a return model shall not be forgotten. In the next few sections,
we discuss some more realistic return models.

\item{\bf \gls{garch} models}

``GARCH'' is the acronym for ``Generalized Autoregressive Conditional
Heteroscedasticity''. A \gls{garch}(p, q) model is defined by the following
equation system \cite{Bollerslev86}:
\begin{equation}
  \label{eq:garch_def}
  \begin{aligned}
    r_t &= \mu_t + \epsilon_t \\
  \end{aligned}
\end{equation}
where $r_t$ is the return as mentioned earlier; $p$ and $q$ are
constant integers; $\mu_t$ is the mean process and considered a small
constant for intraday returns. $\epsilon_t$ is called the innovation
of the return and is a variate whose conditional distribution
\footnotemark is Gaussian and has variance $\sigma^2_t$:
\begin{eqnarray*}
  \sigma_t^2 &=& \alpha_0 + \sum_{i=1}^q \alpha_i \epsilon_{t-i}^2 +
  \sum_{i=1}^p \beta_i \sigma_{t-i}^2
\end{eqnarray*}
\footnotetext{
By conditional distribution we mean the distribution conditional on
the variate's history: The conditional distribution at time $t$ means
the distribution conditional on the history up to time $t-1$
in the discrete-time setting.
}
The quantity $\sigma_t$ introduced here is termed the volatility, and
its meaning and significance has been discussed in the introduction
\ref{chp:introduction}. In the model of geometric Brownian motion it
is assumed constant and hence simply denoted $\sigma$.

% The quantity $\sigma_t$ introduced here is of great importance in
% finance and termed the volatility. Statistically, it is the
% standard deviation of the distribution of $r_t$ and measures how
% volatile $r_t$ is. The volatility of an asset constitutes a major
% risk of investments on the asset and hence is very important.

It can be shown that the autocorrelation function $\varrho_n =
\text{corr}(\epsilon_t, \epsilon_{t-n})$ for $n > \text{max}(p,q)$ of
$\epsilon_t^2$ is given by \cite{Bollerslev87}:
\begin{eqnarray*}
\varrho_n &=& \sum_{i=1} ^{p \vee q}
(\alpha_i + \beta_i) \varrho_{n-i} \text{ for $n > p$}
\end{eqnarray*}
where $\alpha_i$ with $i > q$ and $\beta_i$ with $i > p$ are taken as
zeros. $p \vee q$ denotes the maximum of p and q. From these
equations, it is clear that the partial autocorrelation function cuts
off at $\max(p, q)$.

Here we note that, in the \gls{garch} model, the volatility $\sigma_t$ is
$\mathcal{F}_{t-1}$ measurable: given the history up to time $t-1$,
$\sigma_t$ is a deterministic quantity. In contrast, \gls{sv} models,
which we discuss shortly, treat $\sigma_t$ as a random variable even
given the same history.

\item {\bf Stochastic Volatility Models}\label{sec:SLV_model}

For the purpose of intraday returns, we specify the \gls{sv} model as
\begin{eqnarray}
   r_{t, t-h} &=& \ln S_{t} - \ln S_{t-h} \nonumber \\
   r_{t, t-h} &=& \mu + \sigma_{t, t-h} b_t \label{eq:SLV_spec}
\end{eqnarray}
where $S_t$ is the price of the asset at time $t$; $b_t \sim N(0,
1)$; $r_{t, t-h}$ is the return over the time interval $[t-h, t]$.
For simplicity, in the rest of this chapter we shall just write
$t$ for the subscript ``t, t-h'', since the time interval $h$ is fixed
for each time series and is a known constant.

Andersen et al proved the following in \cite{Andersen03} (theorem 2):
\begin{equation}
  \label{eq:normal_r}
  r_t|\mathcal{F}_{t-h} \sim N(\int_{0}^h \mu_{t-h+s} ds, \int_{0}^h
  \sigma_{t-h+s}^2 ds)
\end{equation}
In plain words, conditional on the information up to time $t-h$, the
distribution of $r_t$ is Gaussian with integrated mean and variance.
The variance of this conditional distribution, $\int_{0}^h
\sigma_{t-h+s}^2 ds$, can be approximated by \cite{Protter05,
  Andersen03}:
\begin{equation}
  \label{eq:rv_def}
  \int_{0}^h \sigma_{t-h+s}^2 ds = \sum_{k=1}^n \left(
    \ln S_{t-h+kh/n} - \ln S_{t-h+(k-1)h/n} \right)^2
\end{equation}
where $n$ is a chosen constant. The square root of the right hand side
of equation \ref{eq:rv_def} is the realized volatility, call it
$\hat{\sigma}_t$.

With the availability of transaction data, estimating conditional
volatility using returns sampled at a higher frequency (realized
volatility) gives superior accuracy and reliability. However, at which
frequency the time series should be sampled (the choice of $n$) in
order to give an unbiased and consistent estimate of the volatility is
not a trivial question. Naively one would believe that the often the
series is sampled, the better the estimate, but in fact, due to noise
introduced by market micro-structure, there is an optimal sampling
frequency, depending on $h$. While the method to determine this
optimal frequency is a subject of debate (see for example
\cite{Sahalia05}), it is not difficult to find a fairly satisfactory
frequency in practice:

Keeping equation \ref{eq:normal_r} in mind, one can simply try a few
frequencies and compare the distribution of $(r_t -
\E(r_t))/\hat{\sigma}_t$ with the standard Gaussian. If the two match,
$\hat{\sigma}_t$ is a good approximation of
\[
\sigma_t = \left(\int_{0}^h \sigma_{t-h+s}^2 ds \right)^{1/2}
\]

Once a good approximation of $\sigma_t$ has been found, it is
convenient to model $\ln\sigma_t$ so that the positivity of $\sigma_t$
is implied by construction \cite{Mikosch2009}. As is seen in later
sections, \gls{arima} models often serve well for this purpose. An
\gls{arima}(p, d, q) model, where $p,d,q$ are integers, is defined as
\cite{BoxJenkins94}
\begin{eqnarray*}
  (1 - \sum_{i=1}^p \phi_i B^i) (1 - B)^d \ln \sigma_t &=& (1 -
  \sum_{i=1}^q \theta_i B^i) y_t
\end{eqnarray*}
where $B$ is the back-shift operator such that $B x_t = x_{t-1}$ for
any time series $x_t$. $y_t$ are termed the residuals of the
model, $d$ is the order of integration, and $p, q$  are orders of
autoregression and moving average, respectively. $\phi_i$ and
$\theta_i$ are constant parameters.

Quite often, the auto-correlation function of the time series in
question manifests periodic patterns, thus seasonal components are
added to the above model to account for the seasonality:
\begin{eqnarray*}
&& (1 - \sum_{i=1}^P \Phi_i B^{is}) (1 - \sum_{i=1}^p \phi_i B^i) (1 - B^s)^D (1 -
B)^d\ln \sigma_t \\
&& = (1 - \sum_{i=1}^Q \Theta_i B^{is}) (1 -
\sum_{i=1}^q \theta_i B^i)y_t
\end{eqnarray*}
where $D$, analogous to $d$ in the non-seasonal model, is the order of
seasonal integration; $P, Q$ are orders of seasonal autoregression and
moving average, respectively. $\Phi_i$ and $\Theta_i$ are constant
parameters. In the most general situations, the seasonal and the
non-seasonal components do not necessarily combine in the above
multiplicative fashion, so the following model is also of interest:
\begin{eqnarray*}
(1 - \sum_{i=1}^{p+P} \phi_i B^i) (1 - B^s)^D(1 - B)^d \ln
\sigma_t &=& (1 - \sum_{i=1}^{q+Q} \theta_i B^i) y_t
\end{eqnarray*}
In all the above cases, if $d = 0$ and $D = 0$, the model does not
involve integration and hence is called an \gls{arma}(p,q) model. An
even simpler case is where $q = 0$ and $Q = 0$ in addition to $d = 0$
and $D = 0$. These conditions make the model a pure \gls{ar}
process, denoted AR(p).
\end{enumerate}

To compare \gls{garch} and \gls{sv} models at the face of intraday returns,
we study the {\it Nordea Bank} 15-minute returns during the period
2012/01/16 - 2012/04/20 in section \ref{chp:nordea_15min}, 
and {\it Volvo B} 30-minute returns during 2013/10/10 - 2014/04/04 in
section \ref{sec:volvo_30}. Another 4 intraday series are also studied and
collected in appendix \ref{chp:appendix2}. We have chosen these
particular stocks because they have the largest trading volumes in the
Swedish market and hence provide the largest amount of data for
analysis. The time intervals of 15 and 30 minutes are chosen because
they are relatively short and hence give a large amount of data and
yet they are not too short for noise of market
micro-structure\footnotemark to become a concern.
\footnotetext{
Noise of market micro-structure is due to, most importantly,
the difference between the bid and asked prices (bid-ask spread), and
the discreteness of price changes.
}

\section{Case Study: Nordea 15-minute Returns}
\label{chp:nordea_15min}
In this section we investigate the Nordea 15-minute returns sampled
during the period 2012/01/16 - 2012/04/20. In total, these amount to
2022 returns. We use the first 80\% (1617) for model estimation and  the
remaining 20\% (405) for comparing with model forcasts. In section
\ref{sec:nordea_15min_garch} we study the series with a \gls{garch} model 
and in section \ref{sec:nordea_15min_arima} we study it with a
\gls{sv} model.

\subsection{GARCH Model}\label{sec:nordea_15min_garch}
When volatilities are auto-correlated or squared returns and
volatilities are correlated, a \gls{garch}(p, q) model may be
appropriate for the return series under investigation. To find out
whehter this is true in our case, we plot the \gls{acf} of the squared
returns. This is shown in figure \ref{fig:nordea_15min_acf}. If the
aforementioned features are absent from the series, the
auto-correlations are expected to be Gaussian distributed with mean 0
and variance 1/T, and hence mostly reside within the confidence bounds
set by $\pm 2/\sqrt{T}$ \cite{Bollerslev86, Bollerslev87}.

Clearly this is not the case in figure \ref{fig:nordea_15min_acf} ---
the first 5 auto-correlations are rather significant. Moreover, figure
\ref{fig:nordea_15min_vlt_acf} shows even more clearly that the
conditional variances of the series are correlated. These observations
suggest a \gls{garch}(p, q) model can be appropriate.
\begin{figure}[htb!]
  \centering
  \subfigure[]{
    \includegraphics[scale=0.4, clip=true, trim=90 257 105
    220]{../pics/nordea_15min_acf.pdf}
    \label{fig:nordea_15min_acf}
  }
  \subfigure[]{
    \includegraphics[scale=0.4, clip=true, trim=90 259 104
    218]{../pics/nordea_15min_vlt_acf.pdf}
    \label{fig:nordea_15min_vlt_acf}
  }
  \caption{\small \it \ref{fig:nordea_15min_acf}: Auto-correlations
    (ACF) of the squared returns; \ref{fig:nordea_15min_vlt_acf}:
    Auto-correlations (ACF) of squared realized volatilities
    ($\hat{\sigma}^2_t$). The blue lines are confident bounds set at
    $\pm 2/\sqrt{T}$. $T$ is the length of the time series.}
\end{figure}

Starting with a \gls{garch}(1,1) model and taking advantage of the knowledge
that the log-volatility $\ln \sigma_t$ has seasonality $s=33$ (see
figure \ref{fig:nordea_15min_logvol_acf}), we fit to the return series
a \gls{garch}(33, 33) model, limiting to lags 1 and 33 for both ARCH and
\gls{garch} parameters.
\begin{eqnarray*}
  r_t &=& \mu + \epsilon_t \\
  \epsilon_t &=& \sigma_t z_t \\
  \sigma^2_t &=& \alpha_0 + \alpha_1 \epsilon^2_{t-1} + \alpha_s
  \epsilon^2_{t-s} + \beta_1 \sigma^2_{t-1} + \beta_s \sigma^2_{t-s}
\end{eqnarray*}
where the mean process of $r_t$, denoted $\mu_t$ earlier, is simplified
to a mere constant $\mu$ owing to its smallness. by \gls{mle},
parameter values listed in table \ref{tab:nordea_15min_garch} are obtained.
\begin{table}[htb!]
  \centering
  \begin{tabular}{|c|c|c|c|c|c|}
    \hline
    Parameter & $\alpha_0$ & $\alpha_1$ & $\alpha_s$ & $\beta_1$ &
    $\beta_s$ \\
    \hline
    Value & $4.7833 \times 10^{-7}$ & 0.1600 & 0.0667 & 0.6846 &
    0.0342 \\
    \hline
  \end{tabular}
  \caption{\small \it GARCH model parameters}
  \label{tab:nordea_15min_garch}
\end{table}

\subsection{Stochastic Volatility Model}\label{sec:nordea_15min_arima}
For the Nordea Bank 15-minute returns under consideration, it can be
verified that the square root of the sum of squared 30-second returns
makes a good proxy for the volatility. This can be seen from the
probability plot of $z_t = (r_t - \E(r_t))/\hat{\sigma}_t$ (figure
\ref{fig:nordea_bank_15min_z_prob}), i.e. the quotient of the 
15-minute returns over the volatility proxy.
\begin{figure}[htb!]
  \centering
    \includegraphics[scale=0.4, clip=true, trim=80 258 104
    220]{../pics/nordea_bank_15min_z_prob.pdf}
  \caption{\small \it Probability plot of $z_t =
    (r_t-\E(r_t))/\sigma_t$. $\epsilon_t$ are derived 
      from Nordea Bank 15min returns while $\sigma_t$ are realized
      volatilities calculated using 30s returns within each 15min
      interval. Horizontal axis: $z_t$; Vertical axis: CDF of
    $z_t$, arranged on such a scale that the CDF of the standard
    Gaussian is a straight line.}
  \label{fig:nordea_bank_15min_z_prob}
\end{figure}
% In addition, one can see
% from figure \ref{fig:nordea_15min_quotient_acf} and
% \ref{fig:nordea_15min_quotient_squared_acf} that there is essentially
% no auto-correlation in the $z_t$ or the $z_t^2$ series.
% \begin{figure}[htb!]
%   \centering
%   \subfigure[ACF of $z_t$]{
%     \includegraphics[scale=0.4, clip=true, trim=95 236 118
%     200]{../pics/nordea_15min_quotient_acf.pdf}
%     \label{fig:nordea_15min_quotient_acf}
%   }
%   \subfigure[ACF of $z_t^2$]{
%     \includegraphics[scale=0.4, clip=true, trim=95 236 118
%     200]{../pics/nordea_15min_quotient_squared_acf.pdf}
%     \label{fig:nordea_15min_quotient_squared_acf}
%   }
%   \caption{\small \it Nordea 15min $z_t$ and $z_t^2$ ACF.}
% \end{figure}

Andersen and Bollerslev et al reported that, for the exchange
rates between Deutch mark, yen and dollar, $\ln \sigma_t$ is
Gaussian distributed \cite{Andersen03}. This is, however, not the case
for our modestly sized series. In fact, in our case, $\ln \sigma_t$ is
right skewed (skewness 0.3342) and leptokurtic (kurtosis 6.1006). See
figure \ref{fig:nordea_15min_logvol_prob}
\begin{figure}[htb!]
  \centering
  %\vspace{-15mm}
  \includegraphics[scale=0.4, clip=true, trim=80 223 107
  4]{../pics/nordea_15min_logvol_prob.pdf}
  \caption{\small \it Probability plot of Nordea 15min log-volatility
    $\ln\sigma_t$ unconditional distribution}
  \label{fig:nordea_15min_logvol_prob}
\end{figure}
Moreover, the series of $\ln\sigma_t$ shows long-lasting and
periodic autocorrelations with an apparent period of 33 (see figure
\ref{fig:nordea_15min_logvol_acf}). This suggests the series may be
described by a seasonal \gls{arima} model. Thus we first simplify the
series by differencing \cite{BoxJenkins94}:
\begin{equation}
  \label{eq:differenced_lv}
  w_t = (1-B)(1-B^s)\ln\sigma_t  
\end{equation}
where $B$ is the back-shift operator\footnote{For example, $B\,x_t =
  x_{t-1}$} and $s=33$ is the seasonality.

The autocorrelation function of the differenced process $w_t$, as
shown in figure \ref{fig:nordea_15min_w_acf}, clearly points to a seasonal
moving-average model: There are only 4 non-zero autocorrelations in
the plot, located at lags 1, 32, 33, 34, respectively; furthermore,
the two at 32 and 34 are approximately equal. Thus we can write down
the model as
\begin{eqnarray}
  w_t &=& (1 - \theta B)(1 - \Theta B^s) y_t \label{eq:nordea_w}
\end{eqnarray}
where $\theta$ and $\Theta$ are parameters to be determined and $y_t$
is a noise process with constant variance $\sigma_y^2$ and mean
0. $y_t$ is often refered to as the residuals.
\begin{figure}[htb!]
  \centering
  \subfigure[ACF of log-volatility ($\ln\sigma_t$)]{
    \includegraphics[scale=0.4, clip=true, trim=95 230 112
    235]{../pics/nordea_15min_logvol_acf.pdf}
    \label{fig:nordea_15min_logvol_acf}
  }
  \subfigure[ACF of differenced log-volatility ($w_t$)]{
    \includegraphics[scale=0.4, clip=true, trim=95 230 112
    235]{../pics/nordea_15min_w_acf.pdf}
    \label{fig:nordea_15min_w_acf}
  }
  \caption{\small \it Auto-correlations of Nordea 15min log-volatility
    ($\ln\sigma_t$) and differenced log-volatility ($w_t$).}
  \label{fig:nordea1_15min_acf}
\end{figure}

The above seasonal moving average model has the following
autocovariance structure \cite{BoxJenkins94}:
\begin{eqnarray*}
  \gamma_0 &=& \sigma_y^2 (1 + \theta^2)(1 + \Theta^2) \\
  \gamma_1 &=& -\sigma_y^2\theta(1 + \Theta^2) \\
  \gamma_s &=& -\sigma_y^2\Theta(1 + \theta^2) \\
  \gamma_{s+1} &=& \gamma_{s-1}\;=\;\sigma_y^2\theta\Theta
\end{eqnarray*}
These equations together with the measured autocorrelations make
possible an initial estimate of the parameters $\theta$ and $\Theta$:
\begin{eqnarray*}
  {\varrho_{s+1}/\varrho_s} &=& {\gamma_{s+1}/\gamma_s} \;=\; -{\theta \over
    1 + \theta^2} \\
  {\varrho_{s+1}/\varrho_1} &=& {\gamma_{s+1}/\gamma_1} \;=\; -{\Theta \over
    1 + \Theta^2} \\
\end{eqnarray*}
Substituting in the measured values shown in table
\ref{tab:nordea_15min_w_acf},
\begin{table}[htb!]
  \centering
  \begin{tabular}{|c|c|c|c|}
    \hline
    $\varrho_1$ & $\varrho_{s-1}$ & $\varrho_s$ & $\varrho_{s+1}$ \\
    \hline
    -0.4703 &  0.2053 & -0.4564 &  0.2212 \\
    \hline
  \end{tabular}
  \caption{\small \it autocorrelations of differenced log-volatility
    ($w_t$)}
  \label{tab:nordea_15min_w_acf}
\end{table}
we get
\begin{eqnarray*}
  \theta &=& 0.6890 \\
  \Theta &=& 0.6378
\end{eqnarray*}
Among the two roots of each of the 2nd order equations in the above,
we have chosen the one in the range $(-1, 1)$ so as to ensure
invertibility of the model \cite{BoxJenkins94}.

With an estimate of $\theta$ and $\Theta$, one can then infer the
noise process i.e. the residuals $y_t$:
\begin{equation}
  \label{eq:infer_y}
  y_t = w_t + \theta y_{t-1} + \Theta y_{t-s} - \theta \Theta y_{t-s-1}
\end{equation}
where we substitute $y_t\;(t \leq 0)$ with their unconditional
expectation 0.

In order to forecast the $w_t$ process, and hence the return process
itself, we must also know the distribution of $y_t$. Moreover, to
properly estimate the parameters of the model in the sense of maximum
likelihood, we are also in need of the distribution of $y_t$.

Figure \ref{fig:nordea_15min_y_qq} shows the normal probability plot of
$y_t$. It is evident from this figure that $y_t$ has fat tails.
\begin{figure}[htb!]
  \centering
  \includegraphics[scale=0.4, clip=true, trim=78 255 109
  123]{../pics/nordea2_y_normplot.pdf}
  \caption{\small \it Normal probability plot of residuals of
    log-volatility ($y_t$)}
  \label{fig:nordea_15min_y_qq}
\end{figure}
In addition, a simple calculation reveals that the distribution of
$y_t$ has skewness 0.2988 (shown in table
\ref{tab:nordea_15min_y_moments}).
\begin{table}[htb!]
  \centering
  \begin{tabular}{|c|c|c|c|}
    \hline
    mean & variance & skewness & kurtosis \\
    \hline
    0.0012 & 0.0935 & 0.2988 & 6.8691 \\
    \hline
  \end{tabular}
  \caption{\small \it Moments of log-volatility residuals ($y_t$)}
  \label{tab:nordea_15min_y_moments}
\end{table}
Based on this information, we find that $y_t$ can be well
described by a Johnson Su distribution. This is a flexible
distribution that features fat tails and positive skewness. It is
defined by the following transformation \cite{Shang2004}:
\[
  y_t = \xi + \lambda\sinh{z_t - \gamma \over \delta}
\]
where $\gamma, \delta, \lambda, \xi$ are parameters to be determined
and $z_t \sim N(0, 1)$. The goodness of fitting is demonstrated in
figure \ref{fig:nordea_15min_y_js_fit} by the
empirical cummulative distribution function in comparison to the
theoretical one.
\begin{figure}[htb!]
  %\vspace{-18mm}
  \centering
    \includegraphics[scale=0.4, clip=true, trim=92 229 116
    133]{../pics/nordea_15min_y_js_fit.pdf}
    \caption{\small \it Log-volatility residuals $y_t$ fitted to a
      Johnson Su distribution. Horizontal: values of $y_t$, denoted x;
      Vertical: $\ln\left(P(y_t < x)\right)$.}
    \label{fig:nordea_15min_y_js_fit}
\end{figure}

The first 4 moments of the Johnson Su distribution are expressible
in closed form in $\gamma, \delta, \lambda, \xi$ \cite{Shang2004}.
% \begin{eqnarray*}
%   w &=& \exp{1 \over \delta^2} \\
%   \Omega &=& {\gamma \over \delta} \\
%   \text{E}(y) &=& -w^{1/2} \lambda \sinh\Omega + \xi\\
%   \text{std}(y) &=& \lambda \left[{1 \over 2}(w-1)(w\cosh 2\Omega +
%     1)\right]^{1/2} \\
%   \text{skewness}(y) &=& {
%     \sqrt{(1/2)w(w-1)} [w(w+2)\sinh 3\Omega + 3\sinh\Omega]
%     \over
%     (w\cosh 2\Omega + 1)^{3/2}} \\
%   \text{kurtosis}(y) &=& {
%     w^2(w^4 + 2w^3 + 3w^2 - 3)\cosh 4\Omega + 4w^2 (w+2) \cosh 2\Omega
%     + 3(2w+1) \over
%     2(w\cosh 2\Omega + 1)^2 }
% \end{eqnarray*}
By matching the theoretical expressions of the moments with their
measured values, and taking help from published tables
\cite{Johnson1965}, one can solve for the parameters $\gamma, \delta,
\lambda, \xi$.

Under the assumption of i.i.d Johnson Su distributed residuals, the
log-likelihood function of the parameters $\theta, \Theta$
conditional on the sample $w_t$ can be written as
\[
L(\theta, \Theta) = -{1 \over 2}\sum_{t=1}^n z_t^2 + n \ln{\delta
  \over \lambda \sqrt{2\pi}} - {1 \over 2}\sum_{t=1}^n \ln\left[
  1 + \left({y_t - \xi \over \lambda}\right)^2
\right]
\]
where $y_t$ are inferred from $w_t$ using eq.\ref{eq:infer_y}
and $z_t$ from $y_t$ using
\[
z_t = \delta \sinh^{-1}{y - \xi \over \lambda} + \gamma
\]
Note that $\gamma, \delta, \lambda, \xi$ are not really free
parameters but rather are implied by $\theta$ and $\Theta$: Once the
latter have been chosen and the corresponding $y_t$ inferred, the
former are determined by the moments of $y_t$.

% The eventual MLE is done in Matlab with the ``active set''
% algorithm. The initial as well as the final estimation results are
% listed in table \ref{tab:nordea_15min_js_param}:
% \begin{table}[htb!]
%   \centering
%   \begin{tabular}{|c|c|c|c|c|c|c|}
%     \hline
%     & $\gamma$ & $\delta$ & $\lambda$ & $\xi$ & $\theta$ & $\Theta$ \\
%     \hline
%     initial estimate & 0.1476 & 1.5121 & 0.3633 & 0.0454 & 0.6890 &
%     0.6378 \\
%     \hline
%     MLE estimate & 0.1319 & 1.5266 & 0.3735 & 0.0410 & 0.6639 & 0.6025
%     \\
%     \hline
%   \end{tabular}
%   \caption{\small \it Nordea 15min estimation results}
%   \label{tab:nordea_15min_js_param}
% \end{table}

\subsection{Comparison of the Forecasts}
In this section we compare the one-step-ahead forecasts from the \gls{garch}
model and from the \gls{sv} model. For this purpose, we
compute the difference between a forecast $\ln \sigma^F_t$ and its measured
counterpart, i.e. the realized volatility of the same period $\ln
\hat{\sigma}_t$. As a reference, we also consider the results obtained
by taking the mean of the realized volatilities of the first 80\% of
the data set as forecast for the volatilities of the remaining 20\%. We
call this naive forecast the ``sample mean''.

First of all, we look at the means and standard deviations of $\ln \sigma^F_t -
\ln \hat{\sigma}_t$, which are listed in table \ref{tab:nordea_2012}.
\begin{table}[htb!]
  \centering
  \begin{tabular}{|c|c|c|c|}
    \hline
    & \gls{sv} & \gls{garch} & Sample mean \\
    \hline
    $\E(\ln \sigma^F_t - \ln \hat{\sigma}_t)$ & 0.0040 & -0.0008 &
    -0.2210 \\
    \hline
    $\text{std}(\ln \sigma^F_t - \ln \hat{\sigma}_t)$ & 0.2659 & 0.3011 &
    0.2893 \\
    \hline
  \end{tabular}
  \caption{\small \it Mean and standard Deviation of the forecasts'
    distribution}
  \label{tab:nordea_2012}
\end{table}
It is seen from table \ref{tab:nordea_2012} that, on average, the \gls{sv}
model over-estimates while \gls{garch} under-estimates. In terms of the
standard deviation of $\ln \sigma^F_t - \ln \hat{\sigma}_t$, the \gls{sv}
model wins with a small margin. In contrast, the sample mean forecast
clearly under-estimates the log-volatilities to a large
extent. So the efforts of building models have indeed led
  to more accurate forecasts.

Figure \ref{fig:nordea_2012} compares the 3 kinds of forecasts by
plotting the distribution function and the complementary distribution
function of $\ln \sigma^F_t - \ln \hat{\sigma}_t$. Here one can see
that the \gls{sv} model yields a better quality of forecasts than does \gls{garch} 
with respect to both under-estimates and over-estimates.

\begin{figure}[htb!]
  \centering
    \includegraphics[scale=0.55, clip=true, trim=40 296 16
    260]{../pics/nordea_2012.pdf}
  \caption{\small \it Blue: SV forecasts; Green: GARCH forecasts; Red:
    sample mean forecasts. Left: $P(\ln \sigma^F_t - \ln \hat{\sigma}_t < x)$;
    Right: $P(\ln \sigma^F_t - \ln \hat{\sigma}_t > x)$. Horizontal: $x$.}
  \label{fig:nordea_2012}
\end{figure}

Another measure of the forecasts' quality can be the percentage of good
forecasts, where the criterion of ``good'' is defined, respectively,
as the forecast deviating less than 1\%, 5\%, or 10\% from the
corresponding realized log-volatility. Table
\ref{tab:nordea_2012_good} shows the respective percentage of the 3
kinds of forecasts. Again in this table it is seen that the \gls{sv}
model gives more accurate forecasts than does \gls{garch}. For
example, defining a ``good'' forecast as one that deviates less than
5\% from the realized volatility, the probability of obtaining such a
good forecast is 75\% using the \gls{sv} model, 71\% using the
\gls{garch} model, and only 53\% using the sample mean.
\begin{table}[htb!]
  \centering
  \begin{tabular}{|c|c|c|c|}
    \hline
    ${|\ln \sigma^F_t - \ln \hat{\sigma}_t| \over |\ln \hat{\sigma}_t|}$
    & \gls{sv} & \gls{garch} & sample mean \\
    \hline
    1\% & 22\% & 14\% & 11\% \\
    \hline
    5\% & 75\% & 71\% & 53\% \\
    \hline
    10\% & 97\% & 94\% & 89\% \\
    \hline
  \end{tabular}
  % \begin{tabular}{|c|c|c|c|}
  %   \hline
  %   ${\ln \sigma^F_t - \ln \hat{\sigma}_t \over |\ln \hat{\sigma}_t|}$
  %   & \gls{sv} & GARCH & sample mean \\
  %   \hline
  %   1\% & 21.73\% & 13.83\% & 11.36\% \\
  %   \hline
  %   5\% & 74.57\% & 70.62\% & 53.33\% \\
  %   \hline
  %   10\% & 97.28\% & 93.83\% & 89.14\% \\
  %   \hline
  % \end{tabular}
  \caption{\small \it The percentage of ``good'' forecasts when the
    criterion of being good is deviating no more than 1\%, 5\% or
    10\%.}
  \label{tab:nordea_2012_good}
\end{table}

\section{Case study: Volvo 30-minute Returns}
\label{sec:volvo_30}
In this section we model the log-volatility of {\it Volvo B} 30-minute
returns during the period 2013/10/10 - 2014/04/04. This series
contains 1884 log-volatilities computed using 2-minute returns in each
30-minute interval. Among them we use the first 1507 for model
estimation and the last 377 for forecast and model verification.

The left plot of figure \ref{fig:volvo_inno_and_lv_acf} shows the
distribution of $(r_t - \E(r_t))/\sigma_t$. We observe in the figure a
nice Gaussian variate, so we can be sure that the sum of squared
2-minute returns makes a good approximation to the variance of
30-minute returns in this particular case.
\begin{figure}[htb!]
  \centering
  \includegraphics[scale=0.4, clip=true, trim=0 256 0
  151]{../pics/volvo_inno_and_lv_acf.pdf}
  \caption{\small \it Left: probability plot of $(r_t -
    \E(r_t))/\sigma_t$; Right: auto-correlations of $\ln \sigma_t$}
  \label{fig:volvo_inno_and_lv_acf}
\end{figure}

Guided by the auto-correlations of $\ln\sigma_t$ shown in the right
plot of figure \ref{fig:volvo_inno_and_lv_acf} we find the following
model:
\begin{eqnarray}
  && (1 - B)(1 - B^s) \ln \sigma_t \nonumber \\
  &=& (1 - \theta_1 B - \theta_2B^2 -
  \theta_3B^3 - \theta_4B^4) (1 - \Theta B^s)
  y_t \label{eq:volvo_lv_model}
\end{eqnarray}
where $s = 16$ is the seasonality and is apparent from the
auto-correlations of $\ln\sigma_t$. Fitting this model to the
measured realized volatilities yields the parameter values listed in
table
\ref{tab:volvo_params}.
\begin{table}[htb!]
  \centering
  \begin{tabular}{|c|c|c|c|c|c|c|}
    \hline
    Parameter & $\theta_1$ & $\theta_2$ & $\theta_3$ & $\theta_4$ &
    $\Theta$ & residual variance \\
    \hline
    Value & 0.7305 & 0.0575 & 0.0574 & 0.0346 & 0.8324 & 0.1340\\
    \hline
  \end{tabular}
  \caption{\small \it Volvo B log-volatility parameters}
  \label{tab:volvo_params}
\end{table}
Forecasting using the estimated model parameters gives the forecast
series $\ln \sigma^{\text{SV}}_t$. To access the quality of the
forecast, we also estimate a \gls{garch} model using the returns. The result
is a \gls{garch}(1, 1) model, whose parameter values are listed in table
\ref{tab:volvo_garch}.
\begin{table}[htb!]
  \centering
  \begin{tabular}{|c|c|c|c|}
    \hline
    Parameter & $\alpha_0$ & $\alpha_1$  & $\beta_1$ \\
    \hline
    Value & $3.125 \times 10^{-7}$ & 0.05 & 0.90 \\
    \hline
  \end{tabular}
  \caption{\small \it GARCH(1, 1) model of Volvo B 30-minute returns}
  \label{tab:volvo_garch}
\end{table}

The forecasts from \gls{sv}, \gls{garch}, and the sample mean are compared
using the difference $\ln \sigma^F_t - \ln\hat{\sigma}_t$, where $\ln
\sigma^F_t$ stands for the forecast. The distributions of this
difference is plotted in figure \ref{fig:volvo_slv_garch_cmp}; the
mean and the standard deviation of the distributions are listed in
table \ref{tab:volvo_slv_garch_cmp}.
\begin{table}[htb!]
  \centering
  \begin{tabular}{|c|c|c|c|}
    \hline
    & \gls{sv} & \gls{garch} & Sample mean \\
    \hline
    $\E(\ln \sigma^F_t - \ln \hat{\sigma}_t)$ & -0.0123 &
    0.0242 & -0.1055 \\
    \hline
    $\text{std}(\ln \sigma^F_t - \ln \hat{\sigma}_t)$ & 0.3261 &
    0.4250 & 0.3708 \\
    \hline
  \end{tabular}
  \caption{\small \it Standard deviation of $\ln\sigma^F_t -
    \ln\hat{\sigma}_t$}
  \label{tab:volvo_slv_garch_cmp}
\end{table}

\begin{figure}[htb!]
  \centering
  \includegraphics[scale=0.5, clip=true, trim=10 282 0
  243]{../pics/volvo_slv_garch_cmp.pdf}
  \caption{\small \it Blue: SV forecasts; Green: GARCH forecasts; Red:
    sample mean forecasts. Left: $P(\ln \sigma^F_t - \ln
    \hat{\sigma}_t < x)$; Right: $P(\ln \sigma^F_t - \ln
    \hat{\sigma}_t > x)$. Horizontal: $x$.}
  \label{fig:volvo_slv_garch_cmp}
\end{figure}
Figure \ref{fig:volvo_slv_garch_cmp} shows, as in the previous case of
Nordea Bank 15-minute returns, the \gls{sv} model performs the best, \gls{garch}
the second, and the sample mean the worst. However, when it comes to
over-estimates, the sample mean appears to be the best estimator,
while \gls{sv} excels over \gls{garch}. But a check of $\E(\ln\sigma_t)$ over
the sample for estimation (1507 data points) and over the sample for
comparison (377 data points) reveals that the first sample has mean
-6.3127 while the second has -6.2072. This increment explains the low
probability of over-estimation when using the first sample mean as
forecast. 

Table \ref{tab:volvo_good_percentage} compares the fraction of
``good'' estimates as measured by ${|\ln\sigma^F_t -
  \ln\hat{\sigma}_t| \over |\ln \hat{\sigma}_t|}$ being less than 1\%,
5\% and 10\%.
\begin{table}[htb!]
  \centering
  \begin{tabular}{|c|c|c|c|}
    \hline
    ${|\ln \sigma^F_t - \ln \hat{\sigma}_t| \over |\ln
      \hat{\sigma}_t|}$ &
    \gls{sv} & \gls{garch} & Sample Mean \\
    \hline
    1\% & 22\% & 12\% & 14\% \\
    \hline
    5\% & 72\% & 62\% & 66\% \\
    \hline
    10\% & 92\% & 88\% & 90\% \\
    \hline
  \end{tabular}
  % \begin{tabular}{|c|c|c|c|}
  %   \hline
  %   ${|\ln \sigma^F_t - \ln \hat{\sigma}_t| \over |\ln
  %     \hat{\sigma}_t|}$ &
  %   \gls{sv} & \gls{garch} & Sample Mean \\
  %   \hline
  %   1\% & 21.75\% & 12.20\% & 14.06\% \\
  %   \hline
  %   5\% & 71.62\% & 61.54\% & 66.31\% \\
  %   \hline
  %   10\% & 92.31\% & 88.06\% & 89.92\% \\
  %   \hline
  % \end{tabular}
  \caption{\small \it Fraction of ``good'' forecasts as defined by
    ${|\ln \sigma^F_t - \ln \hat{\sigma}_t| \over |\ln
      \hat{\sigma}_t|}$ being less than 1\%, 5\% and 10\%.}
  \label{tab:volvo_good_percentage}
\end{table}
We see from the table that the \gls{sv} model consistently excels over
the other two alternatives. In addition, it is also noted that the
\gls{garch} forecast is even worse than the sample mean. This is surprising
but not totally unexpected --- with only 3 parameters, the \gls{garch}(1,1)
model can only describe the most prominent auto-correlations in the
volatility. When the volatility is influenced by relatively weak
auto-correlations at several different time lags, the \gls{garch} forecast
cannot be expected to have good accuracy.

In this particular case, we see that the \gls{arima} model has 3 relatively
small moving average coefficients, located at lags 2, 3, and 4 and
evaluated to 0.06, 0.06, 0.03, suggesting a scattered auto-correlation
structure, so the \gls{garch} model cannot be expected to perform very
well. In contrast, the Volvo 15-minute returns studied in
section \ref{sec:volvo} has more concentrated auto-correlations --- 0.12 and
0.06 at lags 2 and 3 --- thus the \gls{garch}(1,1) model is also found to
perform better and even marginally better than the \gls{sv} model for the
same series.

\section{Unconditional Distribution Functions of SV Models}
\label{sec:XieCalc}
In this section we study the unconditional distribution function of
the \gls{sv} model specified as equation
\ref{eq:SLV_spec}. As is discussed at the beginning of this chapter,
$\ln\sigma_t$ can be described by an \gls{arma} or \gls{arima} model,
possibly with seasonal components. Here we note that all these models
can be re-written as a moving average model, which is infinite in extent if
autoregressive components are present:
\begin{eqnarray*}
  \ln \sigma_t &=& y_t + \sum_{n=1}^\infty c_n y_{t-n} + \text{Const.}
\end{eqnarray*}
Since the $y_t$ are independent and identically distributed,
\begin{eqnarray*}
  y_t + \sum_{n=1}^\infty c_n y_{t-n}  
\end{eqnarray*}
has Gaussian distribution by the central limit theorem, on condition
that $y_t$ for all $t$ have finite second moment --- this is what we
assume in the rest of this section. It follows that the unconditional
distribution of $\ln \sigma_t$ is the same as the distribution of
$\bar{v} + v$ where $v \sim N(0, \sigma)$ and $\bar{v}$, $\sigma$ are
constants. Now we can state that the unconditional distribution of the
returns $r_t$
\begin{eqnarray*}
  r_t &=& \mu + \sigma_t b_t\\
  &=& \mu + b_t \exp\left(
    y_t + \sum_{n=1}^\infty c_n y_{t-n} + \text{Const.}
  \right)
\end{eqnarray*}
 is the same as
\begin{equation}  \label{eq:UnconditionalPdf}
  \begin{aligned}
    r &= \mu + e^{\bar{v} + v} b \\
  \end{aligned}
\end{equation}
where $b \sim N(0, 1)$. For convenience, let $r' = e^v b$

In section \ref{sec:SLV_Symmetric} we first study the model in the
relatively simple case when $v$ and $b$ are uncorrelated and $\mu
= 0$. If this simplified version proves inadequate, one may resort to
the general model studied in section \ref{sec:SLV_Asymmetric}.

\subsection{The Simplified model}\label{sec:SLV_Symmetric}
In the following we derive the unconditional \gls{pdf} of $r'$, the
de-meaned\footnote{By ``de-mean'' we mean subtracting from
  a random variable its expectation value.} and rescaled
return. Denote this \gls{pdf} $f_{r'}(x)$. Then the \gls{pdf} of $r$ is
$e^{-\bar{v}}f_{r'}(e^{-\bar{v}}x)$. First we consider
\begin{eqnarray*}
  P(r' < x) &=& P(b < xe^{-v}) \\
  f_{r'}(x) &=& f_b(xe^{-v}) e^{-v}
\end{eqnarray*}
Averaging over all $v$, we get
\begin{equation}\label{eq:UncondPDFSymmetric}
  \begin{aligned}
    f_{r'}(x) =& \int_{-\infty}^{\infty} dv (2\pi\sigma^2)^{-1/2}
    e^{-v^2/2\sigma^2}(2\pi)^{-1/2} \exp(-x^2e^{-2v}/2) e^{-v} \\
    =& {1 \over 2\pi\sigma} \int_{-\infty}^{\infty} dv
    \exp\left(
      -{1 \over 2\sigma^2} v^2 - v -{1 \over 2} x^2 e^{-2v}
    \right)
  \end{aligned}
  \end{equation}
The last part of the integrand, $e^{-x^2 e^{-2v} / 2}$, is plotted in
figure \ref{fig:DoubleExp}. We see from the figure that the landscape
defined by this function, roughly speaking, consists of two levels,
the lower one lying at height 0 and the higher one at height 1. The
slope connecting the two levels is rather steep. It changes as a
double exponential along lines of constant $x$ and as $e^{-x^2}$ along
lines of constant $v$. Therefore we approximate this function as a
2-dimensional step function:
\begin{figure}[htb!]
  \centering
  \includegraphics[scale=0.5, clip=true, trim=85 252 100
  231]{../pics/DoubleExp.pdf}
  \caption{\small \it Plot of $\exp(-{1 \over 2} x^2 e^{-2v})$}
  \label{fig:DoubleExp}
\end{figure}
\[
\exp\left(-{1 \over 2} x^2 e^{-2v}\right) \approx \left\{
  \begin{array}{lr}
    0 & \text{if } v < \ln|x| -{1 \over 2} \ln(2\ln 2) \\
    1 & \text{otherwise}
  \end{array}
\right.
\]
Here we note that $\exp\left(-{1 \over 2} x^2 e^{-2v}\right) = 1/2$ at
$v = \ln|x| -{1 \over 2} \ln(2\ln 2)$.

With this approximation we have
\begin{eqnarray*}
  f_{r'}(x) &=& {1\over C}{1 \over 2\pi\sigma} \int_{\ln(|x|/\sqrt{\ln
      4})}^{\infty} dv
  \exp\left(-{1 \over 2\sigma^2} v^2 - v\right) \\
  &=& {1\over C}{e^{\sigma^2 / 2} \over \sqrt{8\pi}} \text{erfc} \left(
    {1 \over \sqrt{2}\sigma} \ln{|x| \over \sqrt{\ln 4}} + {\sigma
      \over \sqrt{2}}
  \right)
\end{eqnarray*}
where $1/C$ has been added for the purpose of normalization.

At large $x$, we may use the asymptotic expansion of $\mathrm{erfc}$
to write
\begin{eqnarray*}
  Cf_{r'}(x) &=& {e^{\sigma^2 / 2} \over \sqrt{8\pi}} \mathrm{erfc}(\xi) \\
  &=& {e^{\sigma^2 / 2} \over \sqrt{8 \pi}}
  \frac{e^{-\xi^2}}{\xi\sqrt{\pi}}\left[
    1 +
    \sum_{n=1}^N (-1)^n \frac{(2n-1)!!}{(2\xi^2)^n} \right] +
  O(\xi^{-2N-1} e^{-\xi^2})
\end{eqnarray*}
where $\xi = {1 \over \sqrt{2}\sigma} \ln{|x| \over \sqrt{\ln 4}} +
{\sigma \over \sqrt{2}}$. The slowest-decaying term is
\[
f_{r,0}(x) = {e^{\sigma^2 / 2} \over \sqrt{8\pi}}
\frac{e^{-\xi^2}}{\xi\sqrt{\pi}}
\]
Let $\zeta = {|x| \over \sqrt{\ln 4}}$. With a bit manipulation one
obtains
\begin{equation*}
  f_{r,0}(x) = {1 \over \pi \sqrt{8}}{1 \over
    \left(\ln\zeta/\sigma\sqrt{2} +
      \sigma/\sqrt{2}\right)\zeta\zeta^{\ln \zeta / 2\sigma^2}
  }
\end{equation*}
From the last equation one can see that, at any neighborhood of large
$x$, $f_{r'}(x)$ may be approximated by $C/|x|^\alpha$, i.e. a power law.
The normalization constant $C$ is calculated in appendix
\ref{chp:symmetric_SV_norm_const} to be $C = \sqrt{2 \ln 4\over
  \pi}$. So, in summary, we can write:
\begin{eqnarray*}
  f_r(x) &=& e^{-\bar{v}} f_{r'}(e^{-\bar{v}} x) \\
    &=& {e^{-\bar{v}} \over C}{e^{\sigma^2 / 2} \over \sqrt{8\pi}}
    \text{erfc} \left({1 \over \sqrt{2}\sigma} \ln{|e^{-\bar{v}}x| \over \sqrt{\ln
          4}} + {\sigma \over \sqrt{2}}
    \right) \\
\end{eqnarray*}
Using the same technique for integration as for normalization, the
cummulative distribution function of $r$ is found to be $F(x)$,
which is the following:
\begin{enumerate}
\item if $x < 0$
  \begin{eqnarray*}
    F(x) &=& {\sqrt{\ln 4} \over C}{e^{\sigma^2 / 2} \over \sqrt{8\pi}}
    \left[
      {e^{-\bar{v}}x \over \sqrt{\ln 4}}\text{erfc}\left(
        {1 \over \sigma \sqrt 2} \ln{-e^{-\bar{v}}x \over \sqrt{\ln
            4}} + {\sigma \over \sqrt 2}
      \right) \right.\\
      && \left. + e^{-\sigma^2 / 2} \text{erfc}\left(
        {1 \over \sigma \sqrt 2} \ln{-e^{-\bar{v}}x \over \sqrt{\ln 4}}
      \right)
    \right]
  \end{eqnarray*}
\item if $x \geq 0$
  \begin{eqnarray*}
    F(x) &=& \frac{1}{2} + {\sqrt{\ln 4} \over C}{e^{\sigma^2 / 2} \over
      \sqrt{8\pi}} \left[
      {e^{-\bar{v}}x \over \sqrt{\ln 4}} \text{erfc}\left(
        {1 \over \sigma \sqrt 2} \ln{e^{-\bar{v}}x \over \sqrt{\ln
            4}} + {\sigma \over \sqrt 2}
      \right) \right. \\
      && \left. + e^{-\sigma^2/2} \text{erfc}\left(
        -{1 \over \sigma \sqrt 2} \ln{e^{-\bar{v}}x \over \sqrt{\ln 4}}
      \right)
    \right]
  \end{eqnarray*}
\end{enumerate}

To verify the validity of the model, we fit the above probability
density function to the de-meaned 30min returns of Volvo B
\footnote{By ``de-meaned returns'' we mean the quantity $r_t - 
  \mean{r_t}$, where $r_t$ are the measured returns and $\mean{r_t}$
  is the sample mean. The data set covers the transaction records of
  Volvo B on the OMX market (Stockholm) between 2013-10-10 and
  2014-03-12. The returns are computed using 1-minute mean prices.}
by means of \gls{mle} using the MATLAB function ``mle''. Then for the
parameters $\sigma$ and $\bar{v}$ we get
\begin{eqnarray*}
  \sigma &=& 0.6355 \\
  \bar{v} &=& -6.0308
\end{eqnarray*}
Then we plot $P(r' > x)$ of the model against its empirical
counterpart on a log-log scale, as shown in figure
\ref{fig:volvo_30min_ret}.
\begin{figure}[htb!]
  % \vspace{-15mm}
  \begin{center}
    \includegraphics[scale=0.4, clip=true, trim=98 231 116
    126]{../pics/volvo_30min_ret.pdf}
  \end{center}
  %\vspace{-5mm}
  \caption{\small \it{$P(r' > x)$ for $x > 0$. Blue: empirical
      probabilities. Red: probabilities predicted by the model.}}
  \label{fig:volvo_30min_ret}
\end{figure}

In general figure \ref{fig:volvo_30min_ret} shows a good fit, but a
closer look reveals that deviations are significant in the regions $r
\in (0, \sigma_r)$ and $r \in (2\sigma_r, 3\sigma_r)$, where
$\sigma_r$ stands for the empirical standard deviation of the
de-meaned returns. These observations are
shown in greater details in figure \ref{fig:volvo_30min_ret2}.
\begin{figure}[htb!]
  \centering
  \subfigure[$\ln(P(r > x))$ with $x \in (0, \sigma_r)$]{
    \includegraphics[scale=0.4, clip=true, trim=93 224 115
    125]{../pics/volvo_30min_ret_0-sigma.pdf}
  }
  \subfigure[$\ln(P(r > x))$ with $x \in (2\sigma_r, 3\sigma_r)$]{
    \includegraphics[scale=0.4, clip=true, trim=93 224 115
    125]{../pics/volvo_30min_ret_2sigma-3sigma.pdf}
  }
  \caption{\small \it Surviving probabilities. Blue: empirical values of $\ln(P(r
    > x))$. Red: Predicted values of $\ln(P(r > x))$.}
  \label{fig:volvo_30min_ret2}
\end{figure}

Moreover, the inefficiency of the model is also manifest in the
skewness of the data. For the Volvo 30min returns, the data has a
skewness of 0.2419, but our model is strictly symmetric, since the
return $x$ appears in equation \ref{eq:UncondPDFSymmetric} only as $x^2$.
Hence the above model needs to be improved to accommodate the non-zero
skewness as well as to account for the discrepancies shown in figure
\ref{fig:volvo_30min_ret2}. This is the subject of the next section.

\subsection{The General model}\label{sec:SLV_Asymmetric}
It has long been hypothesized in the liturature that skewness is the
result of price-volatility correlation (for example
\cite{Potters2003}). Therefore, the most apparent modification is to
allow $v$, the zero-mean Gaussian variate in the log-volatility, and
$b$, the zero-mean Gaussian variate in the innovation of the return,
to be correlated. For convenience we decompose $v \sim N(0, \sigma)$
as $v = \sigma a$ and assume
\begin{eqnarray*}
  \begin{pmatrix}
    a \\
    b
  \end{pmatrix} \sim N(0, \Sigma)
\end{eqnarray*}
with a covariance matrix
\begin{eqnarray*}
    \Sigma &=&
  \begin{pmatrix}
    1 & \psi \\
    \psi & 1
  \end{pmatrix}
\end{eqnarray*}
where $|\psi| < 1$. Then we rewrite equation \ref{eq:UnconditionalPdf}
as
\begin{equation}
  \label{eq:r_t}
  \begin{aligned}
    r &= \mu + e^{\bar{v}} r' \\
    r' &= e^{\sigma a} b \\
  \end{aligned}
\end{equation}
We then get
\begin{eqnarray*}
  && P(r' < x)\\
  &=& P(b < e^{-a\sigma}x) \\
  &=& {1 \over 2\pi |\det(\Sigma)|^{1/2}}
  \int_{-\infty}^{\infty} da \int_{-\infty}^{e^{-a\sigma}x} db
  \exp\left[
    -{1 \over 2} (a, b) \Sigma^{-1}
    \begin{pmatrix}
      a \\
      b
    \end{pmatrix}
  \right] \\
\end{eqnarray*}
After some manipulations we get
\begin{equation}\label{eq:UncondCDFAsymmetric}
  \begin{aligned}
    & P(r' < x) \\  
    &= {1 \over 2\pi \sqrt{1 - \psi^2}} \int_{-\infty}^{\infty} da
    e^{-a^2/2} \int_{-\infty}^{e^{-a\sigma}x} db
    \exp\left[
      - {(b - a\psi)^2 \over 2(1 - \psi^2)}
    \right] \\
    &= {1 \over 2\sqrt{2\pi}} \int_{-\infty}^{\infty} e^{-a^2/2}
    \text{erfc}{a\psi - e^{-a\sigma} x \over \sqrt{2(1-\psi^2)}} da
  \end{aligned}
\end{equation}
Differentiating with respect to $x$ yields the \gls{pdf}
\begin{eqnarray}
  f_{r'}(x) &=& {1 \over 2\pi \sqrt{1 - \psi^2}} \times \nonumber \\
  && \int_{-\infty}^\infty da \exp
  \left[- {
      a^2 + 2\sigma(1 - \psi^2)a - 2a\psi e^{-a\sigma} x + e^{-2a\sigma} x^2
      \over
      2(1 - \psi^2)
  }
  \right] \label{eq:UncondPDFAsymmetric} \\
  f_r(x) &=&  \td{r'}{r} f_{r'}[e^{-\bar{v}} (x - \mu)] \nonumber \\
  &=& e^{-\bar{v}} f_{r'}[e^{-\bar{v}}
  (x-\mu)] \label{eq:UncondPDFAsymmetric1}
\end{eqnarray}
Unlike \ref{eq:UncondPDFSymmetric} where a relatively simple
approximation can be found and thus leads to an analytic result of the
integral, no such approximation has been found by the
author for the integral \ref{eq:UncondPDFAsymmetric}. However, the
\gls{mgf} of \gls{pdf} \ref{eq:UncondPDFAsymmetric}
and \ref{eq:UncondPDFAsymmetric1} are easy enough to find and give the
moments about the origin in closed form. Then by matching the analytic
expressions of the moments with their statistical values from the
sample, the parameters $\sigma$, $\psi$ and $\bar{v}$ corresponding to the
sample can be obtained.

The \gls{mgf} of \ref{eq:UncondPDFAsymmetric1} can be found as follows:
\begin{eqnarray*}
  && M_{r}(t) \\
  &=& \E(e^{tr}) \\
  &=& {1 \over 2\pi \sqrt{1 - \psi^2}} \int_{-\infty}^{\infty} da \exp \left(
    -{a^2 \over 2} - \sigma a
  \right) \int_{-\infty}^{\infty} dx \exp\left[
    t(e^{\bar{v}}x + \mu) - {
      (a\psi - e^{-a \sigma} x)^2 \over 2 (1 - \psi^2)
    }
  \right] \\
  &=& {1 \over \sqrt{2 \pi}} \int_{-\infty}^{\infty} da \exp\left[
    -{a^2 \over 2} + {1 \over 2} e^{2 a \sigma + 2\bar{v}} (1 - \psi^2) t^2 +
    a \psi e^{a \sigma + \bar{v}} t + \mu t
  \right]
\end{eqnarray*}
With the \gls{mgf}, the first 4 moments of $r$ can be computed:
\begin{equation}
  \label{eq:AsymmetricMoments}
  \begin{aligned}
    \E(r) &= \mu +e^{\bar{v}+\frac{\sigma ^2}{2}} \sigma  \psi\\
    \E(r^2) &= \mu ^2+2 e^{\bar{v}+\frac{\sigma ^2}{2}} \mu  \sigma  \psi
    +e^{2 \left(\bar{v}+\sigma ^2\right)} \left(1+4 \sigma ^2 \psi^2\right)\\
    \E(r^3) &= \mu ^3+3 e^{\bar{v}+\frac{\sigma ^2}{2}} \mu ^2 \sigma \psi
    +9 e^{3 \bar{v}+\frac{9 \sigma ^2}{2}} \sigma \psi \left(1+3 \sigma ^2
      \psi ^2\right)
    +3e^{2 \left(\bar{v}+\sigma ^2\right)} \mu  \left(1+4 \sigma ^2 \psi
      ^2\right) \\
    \E(r^4) &= \mu ^4+4 e^{\bar{v}+\frac{\sigma ^2}{2}} \mu ^3 \sigma  \psi
    +36 e^{3 \bar{v}+\frac{9 \sigma ^2}{2}} \mu  \sigma  \psi  \left(1+3
      \sigma ^2 \psi ^2\right)\\ 
    & +6 e^{2 \left(\bar{v}+\sigma ^2\right)} \mu ^2 \left(1+4 \sigma ^2 \psi
      ^2\right)
    +e^{4 \bar{v}+8 \sigma ^2} \left(3+96 \sigma ^2 \psi ^2+256 \sigma ^4
      \psi ^4\right)
  \end{aligned}
\end{equation}
These equations are rather complicated and directly solving them to
obtain the parameters $\mu$, $\sigma$, $\psi$ and $\bar{v}$ is
infeasible. However, in practice, $\E(r)$ is often very small --- so, to
get a rough estimate of the parameters, we may set $\mu = 0$ in the
above equations and, with a bit of manipulation, find the following
equation for $\psi\sigma$:
\begin{equation}
  \label{eq:moment1}
  {\E(r^3) \E(r^4)^{-3/8} \over \E(r^2)^{3/4}} =
  {9\sigma \psi (1 + 3\sigma^2\psi^2) \over (1 +
    4\sigma^2\psi^2)^{3/4}}
  {1
    \over
    (3 + 96\sigma^2\psi^2 + 256\sigma^4 \psi^4)^{3/8}
  }
\end{equation}
This equation can be solved numerically for a given sample to yield an
estimate for $\sigma\psi$, which in turn can be substituted in
equations \ref{eq:AsymmetricMoments}, where $\mu$ has been set to 0,
to give estimates for all the 4 parameters. These estimates then serve
as initial values in a numerical solution to
\ref{eq:AsymmetricMoments} where $\mu$ is kept as a free
variable. This full solution can now be used as the initial estimate
in an \gls{mle} procedure.

It is particularly important in our situation to have a good initial
estimate, because, as has been shown earlier, the \gls{pdf} and the
\gls{cdf} cannot be obtained in closed forms and consequently have to
be evaluated by numerical integration. This is a rather costly
procedure especially in the context of \gls{mle}. So the computation of the
moments under the assumption of $\mu = 0$ is worthwhile.

Following the aforementioned procedure, i.e. computing the initial
estimate by matching the moments and then refining the estimate by
\gls{mle}, we obtain the parameter values for a number of return series,
including the Volvo B 30-minute returns described in
section \ref{sec:SLV_Symmetric}. Table \ref{tab:assets_params} and
\ref{tab:assets_moments} present the obtained parameter values and the
resulting moments, respectively. Figure \ref{fig:Volvo_B_30m_returns},
\ref{fig:Nordea_30m_returns}, and \ref{fig:Ericsson_30m_returns}
compare the empirical distribution functions with the analytic
distribution functions evaluated at these parameters.
\begin{figure}[htb!]
  \centering
  \includegraphics[scale=0.5, clip=true, trim=50 233 63
  136]{../pics/Volvo_B_30m_returns.pdf}
  \caption{\small \it Volvo B 30min returns' unconditional distribution fit to
    the SV model. The time series runs from
    2013/10/10 to 2014/03/12. Left: $P(r < x)$ with $x < 0$; Right:
    $P(r > x)$ with $x > 0$. Blue: empirical CDF obtained from data;
    Green: model CDF computed using equation
    \ref{eq:UncondCDFAsymmetric} with $x$ replaced by
    $(x-\mu)e^{-\bar{v}}$. Both plots are on log-log scale.}
  \label{fig:Volvo_B_30m_returns}
\end{figure}
\begin{figure}[htb!]
  \centering
  \includegraphics[scale=0.5, clip=true, trim=65 241 72
  143]{../pics/Nordea_30m_returns.pdf}
  \caption{\small \it Nordea Bank 30min returns' unconditional
    distribution fit to the SV model. The time
    series runs from 2013/10/10 to 2014/03/12. Left: $P(r < x)$ with
    $x < 0$; Right: $P(r > x)$ with $x > 0$. Blue: empirical CDF
    obtained from data; Green: model CDF computed using equation
    \ref{eq:UncondCDFAsymmetric} with $x$ replaced by
    $(x-\mu)e^{-\bar{v}}$. Both plots are on log-log scale.}
  \label{fig:Nordea_30m_returns}
\end{figure}
\begin{figure}[htb!]
  \centering
  \includegraphics[scale=0.5, clip=true, trim=21 241 28
  146]{../pics/Ericsson_30m_returns.pdf}
  \caption{\small \it Ericsson B 30min returns' unconditional
    distribution fit to the SV model. The time
    series runs from 2013/10/10 to 2014/03/12. Left: $P(r < x)$ with
    $x < 0$; Right: $P(r > x)$ with $x > 0$. Blue: empirical CDF
    obtained from data; Green: model CDF computed using equation
    \ref{eq:UncondCDFAsymmetric} with $x$ replaced by
    $(x-\mu)e^{-\bar{v}}$. Both plots are on log-log scale.}
  \label{fig:Ericsson_30m_returns}
\end{figure}
\begin{table}[htb!]
  \centering
  \begin{tabular}{|c|c|c|c|c|}
    \hline
    & $\psi$ & $\sigma$ & $\bar{v}$ & $\mu$ \\
    \hline
    Volvo B & -1.6$\times 10^{-2}$ & 4.7$\times 10^{-1}$ & -6.2&
    -5.3$\times 10^{-5}$ \\
    Nordea Bank & 1.7$\times 10^{-2}$ & 4.3$\times 10^{-1}$ & -6.4 &
    7.5$\times 10^{-5}$ \\
    Ericsson B & 1.8$\times 10^{-2}$ & 4.5$\times 10^{-1}$ & -6.3 &
    -9.3$\times 10^{-5}$ \\
    \hline
  \end{tabular}
  % \begin{tabular}{|c|c|c|c|c|}
  %   \hline
  %   & $\psi$ & $\sigma$ & $\bar{v}$ & $\mu$ \\
  %   \hline
  %   Volvo B & -1.5747e-02 & 4.6929e-01 & -6.2304e+00 &
  %   -5.3040e-05 \\
  %   Nordea Bank & 1.7234e-02 & 4.2780e-01 & -6.3758e+00 & 7.5230e-05
  %   \\
  %   Ericsson B & 1.8486e-02 & 4.4905e-01 & -6.2834e+00 & -9.2817e-05 \\
  %   \hline
  % \end{tabular}
  \caption{\small \it Parameter Values of Selected Assets'
    returns. The time series are 30-minute returns and run from
    2013/10/10 to 2014/03/12.}
  \label{tab:assets_params}
\end{table}
\begin{table}[htb!]
  \centering
  \begin{tabular}{|c|c|c|c|c|}
    \hline
    & mean & std & skewness & kurtosis \\
    \hline
    \multirow{2}{*}{Volvo B} & -8.7$\times 10^{-5}$ & 2.5$\times 10^{-3}$ &
    -2.7$\times 10^{-2}$ & 7.3 \\
    & -6.9$\times 10^{-5}$ & 2.5$\times 10^{-3}$ & -7.3$\times
    10^{-2}$ & 7.2 \\
    \hline
    \multirow{2}{*}{Nordea Bank} & 7.5$\times 10^{-5}$ & 2.0$\times 10^{-3}$ &
    6.9$\times 10^{-2}$ & 6.7 \\
    & 8.9$\times 10^{-5}$ & 2.0$\times 10^{-3}$ &
    6.7$\times 10^{-2}$ & 6.2 \\
    \hline
    \multirow{2}{*}{Ericsson B} & -8.3$\times 10^{-5}$ & 2.3$\times 10^{-3}$ &
    2.7$\times 10^{-1}$ & 7.7 \\
    & -7.6$\times 10^{-5}$ & 2.3$\times 10^{-3}$ &
    7.9$\times 10^{-2}$ & 6.7 \\
    \hline
  \end{tabular}
  \caption{\small \it Moments of Selected Assets' returns. For each return
    series, the 1st row contains the sample moments, while the 2nd
    constains those computed with MLE parameters. The time series are
    30-minute returns and run from 2013/10/10 to 2014/03/12.}
  \label{tab:assets_moments}
\end{table}

Clearly these figures show a fairly good match of the empirical and
the analytic distribution functions. However, we also see that the
skewness of the returns of Volvo B and Ericsson B have rather
different values when computed from the sample and from the
model. This could be the consequence of the limited sample size or
deficiencies in the estimation procedure described above. We leave
these issues to future studies.

%  This indicates the parameter $\psi$, which is the
% correlation between the log-volatility and the return, may be more
% complicated than the simple constant that has been assumed so far. We
% leave this to later studies.

\subsection{Relation to Conditional Distribution Functions}
\label{sec:SV_Conditional}
In the last section we have shown that the unconditional distribution of
the returns are skewed, which implies the zero-mean Gaussian variate $a$ in the
log-volatility is correlated to the zero-mean Gaussian variate $b$ in
the return (c.f. equation \ref{eq:UnconditionalPdf}).

In the context of conditional distributions and forecast, this
correlation translates to the correlation between the residual of the
log-volatility, denoted $y_t$ in section \ref{chp:nordea_15min} and
section \ref{sec:volvo}, and $b_t$. Now let us consider the forecast
function of an \gls{arima} model:
\begin{eqnarray*}
  \ln \sigma_t &=& y_t + \sum_{i=1}^P \phi_i \ln \sigma_{t-i} -
  \sum_{i=1}^Q \theta_i y_{t-i}
\end{eqnarray*}
where $\phi_i < 2$ if the model involves integration, and $\phi_i <
1$ otherwise. Comparing this equation with equation \ref{eq:r_t}, one
immediately realizes that the conditional \gls{pdf} of $r_t$
\begin{eqnarray*}
  r_t &=& \mu + \sigma_t b_t \\
  &=& \mu + \exp\left(
    y_t + \sum_{i=1}^P \phi_i \ln \sigma_{t-i} -
    \sum_{i=1}^Q \theta_i y_{t-i}
  \right) b_t
\end{eqnarray*}
is given by equation \ref{eq:UncondPDFAsymmetric1} and its moments
given by the equations \ref{eq:AsymmetricMoments} if one makes the
following substitutions:
\begin{eqnarray*}
  \sigma &\to& \text{std}(y_t) \\
  \bar{v} &\to& \sum_{i=1}^P \phi_i \ln \sigma_{t-i} - \sum_{i=1}^Q
  \theta_i y_{t-i} \\
  \psi &\to& \text{corr}(y_t, b_t)
\end{eqnarray*}

For the Nordea series considered in section \ref{chp:nordea_15min},
$\text{corr}(y_t, b_t)$ is found to be $3.56 \times 10^{-2}$; while
for the Volvo series considered in section \ref{sec:volvo},
$\text{corr}(y_t, b_t)$ is found to be $-7.3 \times 10^{-3}$. These
values are comparable to those in table \ref{tab:assets_params}, where
$\psi$ is $1.7 \times 10^{-2}$ for the Nordea series and $-1.6
\times 10^{-2}$ for the Volvo series. The similarity in these values
provides some evidence about the validity of the model.

% It is certainly impossible to compare a predicted conditional
% distribution with observations, but conditional distributions are of
% great interest in the context of risk management and derivative
% pricing, so we point out how they may be calculated for ARIMA
% log-volatility models.
