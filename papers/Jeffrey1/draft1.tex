\documentclass{article}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{enumerate}
\usepackage[bookmarks=true]{hyperref}
\usepackage{bookmark}
\usepackage{graphicx}

\input{../../physics_common}
\title{Importance Sampling}
\author{Xie Xiaolei}
\date{\today}

\begin{document}
\maketitle
\section{Introduction}
We consider the model
\begin{eqnarray*}
V_n &=& A_n V_{n-1} \\
V_0 &=& x_0 \in \mathbb S^{d-1}\\
\end{eqnarray*}
Use the following notations
\begin{eqnarray*}
X_n &=& \frac{V_n}{\|V_n\|} \\
S_n &=& \log \|A_n \cdots A_1 x_0\| \\
\xi_n &=& S_n - S_{n-1} = \log\frac{\|A_n \cdots A_1 x_0\|}{\|A_{n-1}
  \cdots A_1 x_0\|} \\
&=& \log\left\| A_n \frac{A_{n-1} \cdots A_1 x_0}{\|A_{n-1} \cdots A_1
    x_0\|} \right\|\\
&=& \log \|A_n X_{n-1}\|
\end{eqnarray*}
The pair $(X_n, S_n)$ is a Markov additive process with transition
kernel $P$. Assume conditions (M) and (A) of Kesten \cite{Kesten1973}:
\begin{enumerate}
\item $\P(\|A\| = 0) = 0$
\item The top Lyapunov exponent is negative, i.e.
  \begin{equation}
    \label{eq:neg_top_Lyapunov}
    \inf_{n \geq 1} \E \log \|A_n \cdots A_1\| < 0    
  \end{equation}
\item $\exists \xi > 0$ such that $\lambda(\xi) = 1$, where
  $$
  \lambda(\xi) := \inf_{n \geq 1} (\E \|A_n \cdots A_1\|^\xi)^{1/n}
  $$
\end{enumerate}

\section{Consistency}\label{sec:consistency}
By the law of large numbers
\begin{eqnarray*}
  && \P(|V| > u) \\
  &=& \lim_{n \to \infty} {1 \over n} \sum_{i=0}^n \1{|V_i| > u}
\end{eqnarray*}
Define
\[
R_n := \inf\{0 \leq i \leq n: V_i \in \mathcal C\}
\]
and
\[
K_i := \inf\{k \geq 1: k > K_{i-1}, V_k \in \mathcal C, K_0 = 0\}
\]
Then one can write
\begin{eqnarray*}
  && \lim_{n \to \infty} {1 \over n} \sum_{i=1}^n \1{|V_i| > u} \\
  &=& \lim_{n \to \infty} {1 \over n} \left[
    \sum_{i=0}^{K_{R_n}-1} \1{|V_i| > u} + \sum_{i=K_{R_n}}^n \1{|V_i| > u}
\right]
\end{eqnarray*}
For the 2nd term, by a Borel-Cantelli argument, it maybe shown
\[
\lim_{n \to \infty} {1 \over n}\sum_{i=K_{R_n}}^n \1{|V_i| > u} = 0
\]
For the 1st term,
\begin{eqnarray*}
&& \lim_{n \to \infty} {1 \over n} \sum_{i=0}^{K_{R_n}-1} \1{|V_i| >
  u}  \\
&=& \lim_{n \to \infty} {R_n \over n} {1 \over R_n} \sum_{i=1}^{R_n}
\sum_{j=K_{i-1}}^{K_i-1}\1{|V_i| > u} \\
&=& \pi(\mathcal C) \E_\gamma N_u
\end{eqnarray*}
where the law of large numbers of Markov chains has been used to reach
the last line. In addition, it is assumed
\begin{eqnarray*}
  V_{K_i} &\sim& \gamma \; \forall i \geq 0 \\
  \gamma(E) &=& \pi(E)/\pi(\mathcal C)\; \forall E \in \mathcal
  B(\mathcal C)
\end{eqnarray*}
Define
\begin{eqnarray*}
  T_u &=& \inf\{n \geq 1: |V_n| > u\} \\
  \tau &\overset{d}{=}& K_i - K_{i-1} \\
  N_u &:=& \sum_{i=0}^{\tau-1} \1{|V_i| > u}  \\
\end{eqnarray*}
Then $\E_\gamma N_u$ may be evaluated as
\begin{eqnarray*}
  && \E_\gamma N_u \\
  &=& \E_\gamma N_u \1{T_u < \tau} \\
  &=& \int_{\mathds S^{d-1}} \int_{\mathds R} \cdots \int_{\mathds
    S^{d-1}} \int_{\mathds R} N_u \1{T_u < \tau} \times \\
  && \prod_{i=1}^{T_u} e^{-\xi(s_i - s_{i-1}) + \lambda(\xi)}
  {r(x_{i-1}; \xi) \over r(x_{i}; \xi)}P_\xi(x_{i-1}, dx_i \times ds_i) \times \\
  && \prod_{i=T_u+1}^{\tau-1} P(x_{i-1}, dx_i \times d s_i) \\
  &=& \E_{\mathcal D} \left[
    N_u \1{T_u < \tau} e^{-\xi S_{T_u}} {r(x_0; \xi)
      \over r(x_{T_u}; \xi)}
  \right]
\end{eqnarray*}
where
\[
P_\xi(x_{i-1}, dx_i \times ds_i) = e^{\xi(s_i - s_{i-1}) -
  \lambda(\xi)} {r(x_i; \xi) \over r(x_{i-1}; \xi)} P(x_{i-1}, dx_i
\times ds_i)
\]
is the $\xi$-shifted transition kernel of the {\it Markov Additive
  process} $(X_n, S_n)$. $\xi$ is chosen such that 
\[
\lambda(\xi) = \lim_{n \to \infty} \log \left(
\E \|A_n \cdots A_1\|^\xi
\right)^{1/n} = 0
\]
$\E_{\mathcal D}$ denotes expectation taken with respect to the dual
measure defined as
\[
P_{\mathcal D} (x_i, dx_{i+1} \times ds) = \left\{
  \begin{array}{ll}
    P_\xi (x_i, dx_{i+1} \times ds) & \text{ if } i < T_u \\
    P(x_i, dx_{i+1} \times ds) & \text{ if } i \geq T_u \\
  \end{array}
\right.
\]
Because the top Lyapunov exponent is negative, it follows from a lemma
in Kesten \cite{Kesten1973} that there is a $s > 0$ such that
$\lambda(s) < 0$.

Thus we have obtained a consistent estimator
$\pi(\mathcal C)\mathcal E_u$ for $\P(|V| > u)$:
\begin{eqnarray*}
\P(|V| > u) &=& \pi(\mathcal C) \E_{\mathcal D} \mathcal E_u \\
&=& \pi(\mathcal C) \E_{\mathcal D} \left[
  N_u \1{T_u < \tau} e^{-\xi S_{T_u}} {r(x_0; \xi)
    \over r(x_{T_u}; \xi)}
\right]
\end{eqnarray*}

\section{Efficiency}\label{sec:efficiency}
\begin{lemma}
  Let $\beta \in \mathbb R$ satisfy
  \begin{enumerate}
  \item
    \begin{equation}
      \label{eq:drift_cond1}
      \E \|A\|^\beta < \infty      
    \end{equation}
  \item 
    \begin{equation}
      \label{eq:drift_cond2}
    \inf_{\alpha > 0} {\E \|A\|^{\alpha + \beta}
      \over 
      \E \|A\|^{\beta}
    } < 1
    \end{equation}
  \end{enumerate}
  then $\forall \alpha > 0$ such that $\frac{\E\|A\|^{\beta +
      \alpha}}{\E\|A\|^\beta} < 1$ , we have
  \begin{equation}
    \label{eq:drift}
    \E_\beta \left[\left.
        |V_n|^\alpha r_\beta(|\tilde V_n|; \alpha) \I{{\mathcal C}^\complement}(V_{n-1}) \right|
      \mathcal F_{n-1} \right] \leq |V_{n-1}|^\alpha r_\beta(|\tilde
    V_{n-1}|; \alpha) \I{{\mathcal C}^\complement}(V_{n-1})
  \end{equation}
  where $r_\beta(\cdot; \alpha)$ is the unique right eigen function of the
  operator
  \[
  P_{\alpha, \beta} f(x) = \int |\hat a x|^\alpha f\left(
    {\hat a x \over |\hat a x|}
  \right) d\mu_A^\beta(\hat a)
  \]
  where the $\beta$-shifted measure $\mu_A^\beta$ satisfies
  \[
  d\mu_A^\beta(\hat a) = {\|\hat a\|^\beta d\mu_A(\hat a) \over \E\|A\|^\beta}
  \]
\end{lemma}

\begin{proof}
  Conditions \eqref{eq:drift_cond1} and \eqref{eq:drift_cond2} imply $\E_\beta
  \|A\|^\alpha < \infty$. Then, using the results of Buraczewski and
  Collamore et al \cite{BCDZ2014}, one may conclude that an eigen
  function $r_\beta(\cdot; \alpha)$ as well as an eigen measure
  $l_\beta(\cdot; \alpha)$ exists under the $\beta$-shifted
  measure. Thus, by defining the adjoint operator under  the shifted
  measure, the right eigen function $r_\beta(x; \alpha)$ can be represented as
  \[
  r_\beta(x; \alpha) = c \int_{S_+^{d-1}} \inn{x, y}^\alpha
  dl^*_{\beta}(x; \alpha)
  \]
Now, to prove \eqref{eq:drift}, consider
  \begin{eqnarray*}
    && \E_\beta \left[ |V_n|^\alpha r_\beta(\tilde V_n; \alpha) | \mathcal F_{n-1} \right]
    \\
    &=& \E_\beta\left[\int_{S_+^{d-1}} \inn{V_n, y}^\alpha dl^*_{\beta}(y; \alpha)|
      \mathcal F_{n-1} \right]
    \\
    &=& \E_\beta\left[\int_{S_+^{d-1}} (\inn{A_n V_{n-1}, y} + \inn{B_n,
        y})^\alpha dl^*_{\beta}(y; \alpha) | \mathcal F_{n-1} \right]
  \end{eqnarray*}
  \begin{enumerate}
  \item if $\alpha < 1$, by subadditivity we have
    \begin{eqnarray*}
      &&\E_\beta\left[\int_{S_+^{d-1}} (\inn{A_n V_{n-1}, y} + \inn{B_n,
          y})^\alpha dl^*_{\beta}(y; \alpha) | \mathcal F_{n-1} \right]\\
      &\leq& \E_\beta\left[\int_{S_+^{d-1}} \inn{A_n V_{n-1}, y}^\alpha
        dl^*_{\beta}(y; \alpha) | \mathcal F_{n-1} \right]
      + \E_\beta\left[\int_{S_+^{d-1}} \inn{B_n, y}^\alpha dl^*_{\beta}(y; \alpha) |
        \mathcal F_{n-1} \right] \\
      &=& \E_\beta\left[|V_{n-1}|^\alpha |A_n \tilde V_{n-1}|^\alpha\int_{S_+^{d-1}}
        \inn{{A_n V_{n-1} \over |A_n V_{n-1}|}, y}^\alpha
        dl^*_{\beta}(y; \alpha) | \mathcal F_{n-1} \right] \\
      && + \E_\beta\left[\int_{S_+^{d-1}} \inn{B_n, y}^\alpha dl^*_{\beta}(y; \alpha) |
        \mathcal F_{n-1} \right] \\
      &=& |V_{n-1}|^\alpha \left\{
        (P_{\alpha, \beta} r_{\beta})(\tilde V_{n-1}; \alpha) +
        {1 \over |V_{n-1}|^\alpha} \E_\beta |B_n|^\alpha r_\beta(\tilde
        B_n; \alpha) \right\} \\
      &=& |V_{n-1}|^\alpha r_\beta(\tilde V_{n-1}; \alpha)\left\{
        \lambda_\beta(\alpha) +
        {1 \over |V_{n-1}|^\alpha r_\beta(\tilde V_{n-1}; \alpha)} \E_\beta
        |B_n|^\alpha r_\beta(\tilde B_n; \alpha) \right\} \\
    \end{eqnarray*}
    By assumption, $\E_\beta|B_n|^\alpha < \infty$; and
    $r_\beta(\tilde B_n; \alpha) < \infty$, $r_\beta(\tilde V_{n-1};
    \alpha) < \infty$ according to Buraczewski and Collamore \cite{BCDZ2014}.
    Hence the infimum of the expression in the curly bracket over all $n \geq 1$ is
    $\lambda_\beta(\alpha) < 1$. Therefore, when $|V_{n-1}|$ is
    sufficiently large, $\rho_{\beta}(\alpha)$ an be chosen such that
    \begin{eqnarray*}
      \rho_{\beta}(\alpha) &<& 1 \\
      \E_\beta \left[ |V_n|^\alpha r_\beta(\tilde V_n; \alpha)  \I{{\mathcal C}^\complement}(V_{n-1})
        | \mathcal F_{n-1} \right] &\leq&
      \rho_\beta(\alpha) |V_{n-1}|^\alpha r_\beta(\tilde V_{n-1}; \alpha) \I{{\mathcal C}^\complement}(V_{n-1})
    \end{eqnarray*}
    where ${\mathcal C}^\complement$ denotes the complement of the set
    $\mathcal C$:
    \begin{equation}
      \label{eq:C_set}
      \mathcal C := \left\{
        v: |v| \leq M, M = \left[
          \E_\beta (|B|^\alpha r_\beta(\tilde B; \alpha)) 
          \over
          [1 - \lambda(\alpha)] r_\beta(\tilde v; \alpha)
        \right]^{1/\alpha}
      \right\}
    \end{equation}
  \end{enumerate}    
\end{proof}
\begin{remark}
  Iterating \eqref{eq:drift} yields
  \[
  \E_\beta \left[
    |V_n|^\alpha r_\beta(|\tilde V_n|; \alpha) \prod_{i=1}^{n-1}\I{{\mathcal C}^\complement}(V_i)\right]
  \leq \rho_\beta(\alpha)^{n-1} |V_1|^\alpha r_\beta(|\tilde V_1|; \alpha) \I{{\mathcal C}^\complement}(V_1)
  \]
  Then it follows
  \[
  \E_\beta \left[
    |V_n|^\alpha r_\beta(|\tilde V_n|; \alpha) \prod_{i=1}^{n}\I{{\mathcal C}^\complement}(V_i)\right]
  \leq \rho_\beta(\alpha)^{n-1} |V_1|^\alpha r_\beta(|\tilde V_1|; \alpha) \I{{\mathcal C}^\complement}(V_1)
  \]
  But $\prod_{i=1}^{n}\I{{\mathcal C}^\complement}(V_i)$ implies $\tau > n$, and in this
  case $|V_n| > M$, where
  \[
  M = \left[
    \E_\beta (|B|^\alpha r_\beta(\tilde B; \alpha)) 
    \over
    (1 - \lambda(\alpha)) r_\beta(\tilde v; \alpha)
  \right]^{1/\alpha}
  \]
  Hence
  \begin{eqnarray}
    \E_\beta \left[
      M^\alpha \inf_{|\tilde V_n|} r_\beta(|\tilde V_n|; \alpha) \1{\tau > n}\right]
    &\leq& \rho_\beta(\alpha)^{n-1} |V_1|^\alpha r_\beta(|\tilde V_1|;
    \alpha) \I{{\mathcal C}^\complement}(V_1) \nonumber \\
    \P_\beta(\tau > n) &\leq& K \rho_\beta(\alpha)^{n-1} \label{eq:ret_time}
  \end{eqnarray}
  for some constant $K$.
\end{remark}

\begin{lemma}\label{lemma:prob_bound}
  $\exists N \geq 1, 0 < \epsilon < 1, \delta > 0, c > 0$ such that
  $\forall k \geq N$, if $\|A_k \cdots A_1\|^\xi$ has a continuous
  density function on $(a, b) \subseteq (0, \epsilon)$, then $\forall
  x \in (a, b)$
    \[
    \P\left[
      \|A_k \cdots A_1\|^\xi \in [x, x + dx)
    \right] \leq c x^\delta dx
    \]
\end{lemma}
\begin{proof}
  For convenience, write $\Pi_k$ for $\|A_k \cdots A_1\|^\xi$. Suppose
  the claim is false, i.e. $\forall N \geq 1, 0 < \epsilon < 1, (a, b)
  \subseteq (0, \epsilon), \delta > 0, c > 0$, $\exists k > N$ such
  that $\exists x \in  (a, b)$
  \begin{equation}
    \label{eq:opposite_claim}
    \P\left[
      \Pi_k \in [x, x + dx)
    \right] > c x^\delta dx
  \end{equation}
  Suppose $(a_i, b_i) \subseteq (a, b)$, $i = 1, 2, \dots$ are
  intervals on which \eqref{eq:opposite_claim} holds. Then
  \begin{eqnarray*}
    \E \Pi_k \1{a < \Pi_k < b} &\geq&
    \sum_{i} \int_{a_i}^{b_i} x \P(\Pi_k \in [x, x+dx)) \\
    &>& {c \over \delta + 2} \sum_i
    (b_i^{\delta + 2} - a_i^{\delta + 2})
  \end{eqnarray*}
  Clearly $c$ can be chosen to satisfy
  \begin{eqnarray*}
    \E \Pi_k > \E \Pi_k \1{a < \Pi_k < b} > {c \over \delta + 2} \sum_i
    (b_i^{\delta + 2} - a_i^{\delta + 2}) > 1
  \end{eqnarray*}
  But the results of Buraczewski, Damek and Mikosch imply that $\E
  \|A_k \cdots A_1\|^\xi$ can be as close to 1 as is desired if $k$ is
  sufficiently large \cite{BuraczewskiDamekMikosch2015}. Thus a
  contradiction arises and the claim must be true.
\end{proof}

\begin{theorem}
  The estimator $\mathcal E_u$ has bounded relative error, i.e.
  \begin{equation*}
    \limsup_{u \to \infty} {\var(\mathcal E_u) \over [\P(|V| > u)]^2} < \infty
  \end{equation*}
\end{theorem}
\begin{proof}
  The claim is equivalent to
  \[
  \limsup_{u \to \infty} {\E_{\mathcal D} \mathcal E_u^2 \over [\P(|V|
    > u)]^2} < \infty
  \]
  By Kesten's theorem \cite{Kesten1973}, $\P(|V| > u) \sim C
  u^{-\xi}$. Hence, to prove the claim, one needs to check
  $u^{2\xi}\E_{\mathcal D} \mathcal E_u^2 < \infty$, i.e.
  \[
  \limsup_{u \to \infty} \E_{\mathcal D}  \left[u^{2\xi}
    N_u^2 \1{T_u < \tau} e^{-2\xi S_{T_u}} {r^2(x_0; \xi)
      \over r^2(x_{T_u}; \xi)}\right] < \infty
 \]
 Using the fact $|V_{T_u}| > u$, and that $r(\cdot; \xi)$ is bounded
 from above and below, it suffices to show
 \begin{eqnarray*}
   f(\xi) &=& \limsup_{u \to \infty} \E_{\mathcal D} \left[
     \left|
       \sum_{n=0}^{T_u}
       \frac{
         N_u^{1/\xi} A_{T_u} \cdots A_{n+1} B_n 
       }{
         |A_{T_u} \cdots A_1 V_0|
       }
       \1{T_u < \tau}
     \right|^{2 \xi}
   \right] < \infty\\
 \end{eqnarray*}
  In the rest of the proof, we write $c, c_1, c_2, \dots$ for
  constants whose values have no importance and depend on the
  context.
  \begin{enumerate}
  \item We first consider the case $\lambda(-\xi\epsilon) <
    \infty$.
    \begin{enumerate}
    \item If $\xi \geq 1/2$, Minkowski's inequality gives
      \begin{eqnarray}
        f(\xi) &\leq& \limsup_{u \to \infty}
        \left\{
          \sum_{n=0}^{\infty}
          \left[
            \E_{\mathcal D} \left|
              N_u^{1/\xi}
              \frac{
                A_{T_u} \cdots A_{n+1} B_n 
              }{
                |A_{T_u} \cdots A_1 V_0|
              }
              \1{n \leq T_u < \tau}
            \right|^{2 \xi}
          \right]^{1/2\xi}
        \right\}^{2\xi} \nonumber \\
        &\leq& \limsup_{u \to \infty}
        \left\{
          \sum_{n=0}^{\infty}
          \left[
            \E_{-\xi} N_u^2 
            |A_{T_u} \cdots A_{n+1} B_n|^{2\xi}
            \1{n \leq T_u < \tau}
          \right]^{1/2\xi}
        \right\}^{2\xi} \label{eq:xi_above_half_prel}
      \end{eqnarray}
      By H\"older's inequality,
      \begin{eqnarray}
        && \left[ \E_{-\xi} N_u^2 
          |A_{T_u} \cdots A_{n+1} B_n|^{2\xi}
          \1{n \leq T_u < \tau} \right]^{1/2\xi} \nonumber \\
        &\leq& (\E_{-\xi} N_u^{2r})^{1/2r\xi}
        (\E_{-\xi}|B_n|^{2s\xi})^{1/2s\xi}  \nonumber \\
        && (\E_{-\xi} \|A_{T_u} \cdots A_{n+1}\|^{2s\xi}
        \1{n \leq T_u < \tau})^{1/2s\xi}
        \label{eq:xi_above_half}
      \end{eqnarray}
      As shown by Buraczewski, Damek
      and Mikosch \cite{BuraczewskiDamekMikosch2015},
      \[
      \lim_{k \to \infty}
      \left( \E_{-\xi}
        \|A_k \cdots A_{n+1}\|^{2s\xi}
      \right)^{1/(k-n)} = \lambda_{-\xi}(2s\xi)
      \]
      Hence $\forall a > 1$, $\exists N \geq 1$ such that $\forall k
      \geq n + N$,
      \[
      (\E_{-\xi}\|A_{k} \cdots A_{n+1}\|^{2s\xi})^{1/(k-n)} <
      a \lambda_{-\xi}(2s\xi)
      \]
      Meanwhile, for $k \in \{n+1, \dots, n+N-1\}$, due to the
      independence of $A_{n+1}, A_{n+2}, \dots, A_k$ we have
      \begin{eqnarray*}
        && \E_{-\xi} \|A_k \dots A_{n+1}\|^{2s\xi} \\
        &\leq& \left[\E_{-\xi} \|A_1\|^{2s\xi}\right]^{k-n} \\
        &=& \left[{\E \|A_1\|^{(2s - 1)\xi} \over \E \|A_1\|^{-\xi}}\right]^{k-n} \\
      \end{eqnarray*}
      Choose $s \in (1, {1 + \epsilon \over 2})$ such that $\E
      \|A_1\|^{(2s - 1)\xi} < \infty$; Furthermore, choose $s$ and $a$
      as close to 1 as is necessary to make $a \lambda(\xi(2s - 1)) <
      \lambda(-\xi)$ and hence $a \lambda_{-\xi}(2s\xi) < 1$. Such
      choices of $s$ and $a$ are possible since $\lambda(-\xi) >
      \lambda(\xi)=1$. This way,
      \begin{eqnarray*}
        && \E_{-\xi} \|A_{T_u} \cdots A_{n+1}\|^{2s\xi}
        \1{n \leq T_u < \tau} \\
        &=& \sum_{k=n}^\infty \E_{-\xi} \left(
          \|A_k \cdots A_{n+1}\|^{2s\xi}|T_u=k\right)
        \1{T_u < \tau} \P_{-\xi}(T_u = k) \\
        &\leq& c_1 \sum_{k=n}^{n+N-1} \1{T_u < \tau}
        P_{-\xi}(T_u = k) \\
        && + \sum_{k=n+N}^\infty
        \left[a\lambda_{-\xi}(2s\xi)\right]^{k-n}
        \1{T_u < \tau} \P_{-\xi}(T_u = k) \\
        % &\leq& c_1 \sum_{k=n}^{n+N-1} P_{-\xi}(\tau > k-1) \\
        % && + 
        % &\leq& c_1 \left[
        %   \frac{
        %   \lambda(\alpha - \xi)
        % }{
        %   \lambda(-\xi)
        % }
        % \right]^{n}
      \end{eqnarray*}
      Applying \eqref{eq:ret_time} with $\beta = -\xi$ gives
      \begin{eqnarray}
        && \E_{-\xi} \|A_{T_u} \cdots A_{n+1}\|^{2s\xi}
        \1{n \leq T_u < \tau} \nonumber \\
        &\leq& c_1 \sum_{k=n}^{n+N-1} {\lambda_{-\xi}(\alpha)}^k +
        c_2 a^{-n} \lambda_{-\xi}(2s\xi)^{-n}
        \sum_{k=n+N}^\infty \left[
          a \lambda_{-\xi}(2s\xi)
          \lambda_{-\xi}(\alpha)
        \right]^k \nonumber \\
        &\leq& c \lambda_{-\xi}(\alpha)^n \label{eq:norm_term}
      \end{eqnarray}
      for some $\alpha \in (0, 2\xi]$. Now we turn to $(\E_{-\xi}
      N_u^{2r})^{1/2r\xi}$:
      \begin{eqnarray}
        && \E_{-\xi} N_u^{2r} \nonumber \\
        &\leq& \E_{-\xi} \tau^{2r} \nonumber \\
        &\leq& \sum_{k=1}^{\infty} k^{2r} \P_{-\xi}(\tau > k-1)
        \nonumber \\
        &\leq& c_1 + c_2 \sum_{k=2}^{\infty} k^{2r}
        \lambda_{-\xi}(\alpha)^{k-2} < \infty \label{eq:Nu}
      \end{eqnarray}
      By assumption $\E \|B\|^{\epsilon \xi} < \infty$. Hence
      $\E|B|^{-\xi} > 1/\E|B|^\xi > 0$. It follows
      \begin{eqnarray}
        \E_{-\xi}|B_n|^{2s\xi} &=& {
          \E |B_n|^{\xi(2s - 1)}
          \over
          \E |B_n|^{-\xi}
        } \nonumber \\
        &\leq& \E |B|^{\epsilon \xi} \E |B|^{\xi} < \infty \label{eq:Bn}
      \end{eqnarray}
      Combining \eqref{eq:norm_term}, \eqref{eq:Nu}, \eqref{eq:Bn} and
      \eqref{eq:xi_above_half} we get
      \begin{eqnarray}
        && \left[ \E_{-\xi} N_u^2 
          |A_{T_u} \cdots A_{n+1} B_n|^{2\xi}
          \1{n \leq T_u < \tau} \right]^{1/2\xi} \nonumber \\
        &\leq& c \lambda_{-\xi}(\alpha)^n \label{eq:xi_above_half_final}
      \end{eqnarray}
      Inserting RHS of the above into \eqref{eq:xi_above_half_prel}
      gives
      \begin{eqnarray*}
        && \sum_{n=0}^{\infty}
        \left[
          \E_{-\xi} N_u^2 
          |A_{T_u} \cdots A_{n+1} B_n|^{2\xi}
          \1{n \leq T_u < \tau}
        \right]^{1/2\xi} \\
        &\leq& c \sum_{n=0}^{\infty} \lambda_{-\xi}(\alpha)^n \\
        &=& {c \over 1 - \lambda_{-\xi}(\alpha)}
      \end{eqnarray*}
      From this it is clear $f(\xi) < \infty$.
      \item If $\xi < 1/2$, the function $(\cdot)^{2\xi}$ is
        subadditive. Hence
        \begin{eqnarray*}
          f(\xi) &\leq& c \limsup_{u \to \infty}
          \sum_{n=0}^\infty \E_{\mathcal D} N_u^2
          {|A_{T_u} \cdots A_{n+1}B_n|^{2\xi}
            \over
            |A_{T_u} \cdots A_1 V_0|^{2\xi}
          }
          \1{n \leq T_u < \tau} \\
          &\leq& c \limsup_{u \to \infty}
          \sum_{n=0}^{\infty}
            \E_{-\xi} N_u^2 
            |A_{T_u} \cdots A_{n+1} B_n|^{2\xi}
            \1{n \leq T_u < \tau}
        \end{eqnarray*}
        The same arguments that lead to \eqref{eq:xi_above_half_final}
        show $f(\xi) < \infty$.
    \end{enumerate}
  \item Now we consider the case $\lambda(-\xi) = \infty$. In this
    case we assume in addition $\E {1 \over \sigma^{\uparrow}_1(A)^\xi}
    < \infty$ where $\sigma^{\uparrow}_1(A)$ denotes the smallest
    singular value of $A$. Suppose $\Pi_k = \|A_k \cdots A_1\|^\xi$
    has atoms $d_{k,1} < d_{k,2} < \dots$, which form a set $\mathscr S_k$,
    and everywhere else on its support it has a density function.

    By lemma \ref{lemma:prob_bound}, $\exists \epsilon > 0, \delta > 0, b
    > 0$ such that, when $k$ is sufficiently large, the density of $\Pi_k$
    is bounded by $b x^\delta $. Moreover, as argued in the previous
    case, $\forall a > 1$, $\exists N \geq 1$ such that $\forall k
    \geq N$, $\E \Pi_k < a^k \lambda(\xi)^k = a^k$.
    Thus
    \begin{eqnarray*}
      && \E {1 \over |A_{T_u}, \cdots A_1 V_0|^\xi} \1{n \leq T_u < \tau}\\
      &=& {1 \over |V_0|^{\xi}} \sum_{k=n}^\infty \E {1 \over |A_k,
        \cdots A_1 \tilde V_0|^{\xi}} \P(T_u = k) \1{T_u < \tau} \\
      &\leq& {1 \over |V_0|^\xi} \sum_{k=n}^{N-1}
      \E {1 \over |A_k \cdots A_1 \tilde V_0|^\xi}  \P(T_u = k) \1{T_u
        < \tau}\\
      &+& {c \over |V_0|^\xi} \sum_{k=N}^{\infty}
      \E {1 \over \|A_k \cdots A_1\|^\xi}  \P(T_u = k) \1{T_u
        < \tau}
      \end{eqnarray*}
      where $N$ is chosen sufficiently large. In the last step we have
      used the result of Kesten
      \cite{Kesten1973}:
      \[
      \lim_{k \to \infty} {1 \over k} \log |A_k \cdots A_1 \tilde V_0|
      = \lim_{k \to \infty} {1 \over k} \log \|A_k \cdots A_1\| =
      \gamma < 0
      \]
      where $\gamma$ is the top Lyapunov exponent. Thus, when $k$ is
      sufficiently large, $|A_k \cdots A_1 \tilde V_0|^\xi = q(k)^k \|A_k
      \cdots A_1\|^\xi$ for some $q(k) < 1$ and $q(k) \to 1$ as $k \to
      \infty$. Continuing the above calculation we have
      \begin{eqnarray*}
        && \sum_{k=N}^{\infty}
        \E {1 \over \|A_k \cdots A_1\|^\xi}  \P(T_u = k) \1{T_u
          < \tau} \\
      &\leq& \sum_{k=N}^\infty \left[
        \int_{0}^\epsilon b x^{\delta - 1} dx + {1 \over
          \epsilon}\P(\Pi_k > \epsilon)
      \right]
      \1{\Pi_k \notin \mathscr S_k} \P(T_u = k) \1{T_u < \tau} \\
      &+& \sum_{k=N}^\infty \sum_{i} \pi_i^{-1} \P(\Pi_k = \pi_i) \P(T_u =
      k) \1{T_u < \tau} \\
      &\leq& \sum_{k=N}^\infty \left[
        ({b \over \delta}\epsilon^\delta + \epsilon^{-2} \E \Pi_k)
        \1{\Pi_k \notin \mathscr S_k} + {1 \over \pi_1} \P(\Pi_k \in
        \mathscr S_k) \1{\Pi_k \notin \mathscr S_k}\right] \times \\
      && \P(T_u = k) \1{T_u < \tau}
    \end{eqnarray*}
It follows
    \begin{eqnarray*}
      S_1 &\leq& \sum_{k=n}^{N-1} \E {
        1 \over
        \sigma^{\uparrow}_1(A_k)^\xi \cdots \sigma^{\uparrow}_1(A_1)^\xi
      } \P(T_u = k) \1{T_u < \tau} \\
      &\leq& \sum_{k=n}^{N-1} \left[
        \E {1 \over
          \sigma^{\uparrow}_1(A_1)^\xi          
        }
      \right]^k \P(T_u = k) \1{T_u < \tau} < \infty
    \end{eqnarray*}
    \begin{eqnarray*}
      S_2 &\leq& {1 \over |V_0|^\xi} \sum_{k=N}^\infty
      (c\epsilon^\delta + \epsilon^{-2} \E \Pi_k) \P(T_u = k) \1{T_u < \tau} \\
      &\leq& {1 \over |V_0|^\xi} \sum_{k=N}^\infty
      (c\epsilon^\delta + \epsilon^{-2} a^k) \P(T_u = k) \1{T_u < \tau} \\
    \end{eqnarray*}
    where the last step follows from Markov's inequality. Now we note
    $\P(T_u = k)\1{T_u < \tau} \leq \P(\tau > k-1) \leq c
    \lambda(\alpha)^k$ for some constant $c$ and $0 < \alpha <
    \xi$. We choose $\alpha$ and $a, N$ appropriately so that
    $\lambda(\alpha) <  a^{-1} < 1$, and as a result $S_2 < \infty$.
    As for $S_3$, we have
    \begin{eqnarray*}
      S_3 &=& \sum_{k=N}^\infty \P(T_u = k)\1{T_u < \tau}
      \sum_{j} {1 \over d_{k,j}} \P(|A_k \cdots A_1 \tilde V_0|^\xi =
      d_{k,j}) \\
      &\leq& \sum_{k=N}^\infty \P(T_u = k)\1{T_u < \tau} d_{k,1}^{-1}
      \P (|A_k \cdots A_1 \tilde V_0|^\xi \in \mathscr S_k)
    \end{eqnarray*}
    Since $\min_{k \geq 1} d_{k,1} < \infty$, we have
    \begin{eqnarray*}
      && S_3 \leq c \sum_{k=N}^\infty \lambda(\alpha)^k < \infty
    \end{eqnarray*}
  \end{enumerate}
\end{proof}


\bibliographystyle{unsrt}
\bibliography{../../thesis/econophysics}
\end{document}
